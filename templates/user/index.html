{% extends "user/layout.html" %}

{% block title %}
<title>Panorama Geral - OS</title>
{% endblock %}

{% block links %}
<!-- Custom styles for this page -->
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='vendor/datatables/dataTables.bootstrap4.min.css') }}">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/mensagem.css') }}">
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/mutiselect2.css') }}">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/cores-status.css') }}">
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/imagem-modal.css') }}">
<link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" rel="stylesheet" />

{% endblock %}

{% block containerFluid %}

<!-- <button id = 'baixar_csv' onclick="downloadFilteredData()">Baixar CSV<i class="fa-solid fa-download" style="margin-left: 10px;"></i></button> -->

<div class="container-fluid">
    
    <!-- Tabela e filtros -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1></h1>
                <a onclick="downloadFilteredData()" href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                        class="fas fa-download fa-sm text-white-50"></i> Download</a>
            </div>
            <div class="row">
                <div class="col-sm-2 mb-2">
                    <label for="os-filter">OS</label>
                    <input class="form-control" id="os-filter" name="os-filter">
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="execucao-filter">Tipo de Manutenção</label>
                    <select class="form-control" id="execucao-filter" name="execucao-filter">
                        <option value="">Todos</option>  
                        <option value="Não Informado" style="color: transparent;">Não Informado</option>
                        <option value="Corretiva">Corretiva</option>
                        <option value="Preventiva">Preventiva</option>
                        <option value="Preditiva">Preditiva</option>
                        <option value="Apoio">Apoio</option>
                        <option value="Projetos">Projetos</option>
                        <option value="sesmt">SESMT</option>  
                        <option value="Corretiva Programada">Corretiva Programada</option>  
                    </select>
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="execucao-filter">Setor</label>
                    <select class="form-control" id="setor-filter" name="setor-filter">
                        <option value="">Todos</option>
                        <option value="Administrativo">Administrativo</option>
                        <option value="Almoxarifado">Almoxarifado</option>
                        <option value="Corte e estamparia">Corte e estamparia</option>
                        <option value="Expedição">Expedição</option>
                        <option value="Equipamentos de Movimentação">Equipamentos de Movimentação</option>
                        <option value="Solda">Solda</option>
                        <option value="Montagem">Montagem</option>
                        <option value="Pintura">Pintura</option>
                        <option value="Carpintaria">Carpintaria</option>
                        <option value="Usinagem">Usinagem</option>  
                        <option value="Serra">Serra</option>
                        <option value="Serralheria">Serralheria</option>
                        <option value="Manutenção">Manutenção</option>
                        <option value="Forjaria">Forjaria</option>
                        <option value="Utilidades">Utilidades</option>
                        <option value="Qualidade">Qualidade</option>
                    </select>
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="maquina-filter">Máquina</label>
                    <input id="maquina-filter" class="form-control">
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="risco-filter">Risco</label>
                    <select class="form-control form-control" id="risco-filter" style='padding: .375rem .25rem;' name="risco-filter">
                        <option value="">Todos</option>
                        <option>Alto</option>
                        <option>Médio</option>
                        <option>Baixo</option>
                    </select>
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="status-filter">Status</label>
                    <select class="form-control form-control" id="status-filter" style='padding: .375rem .25rem;' name="status-filter">
                        <option value="">Todos</option>
                        <option>Em execução</option>
                        <option>Finalizada</option>
                        <option>Aguardando material</option>
                        <option>Aguardando OK</option>
                        <option>Em espera</option>
                    </select>
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="natureza-filter">Natureza</label>
                    <select class="form-control form-control" id="natureza-filter" style='padding: .375rem .25rem;' name="natureza-filter">
                        <option value="">Todos</option>
                        <option>OS</option>
                        <option>Planejada</option>
                    </select>
                </div>
                <div class="col-sm-2 mb-2">
                    <label for="abertura-filter">Última atualização</label>
                    <input id="abertura-filter" class="form-control">
                </div>
                <!-- <div class="col-sm-2 mb-2">
                    <label for="maquina-parada-filter">Máquina Parada</label>
                    <select class="form-control form-control" style='padding: .375rem .25rem;' id="maquina-parada-filter">
                        <option value="">Todos</option>
                        <option value="true">Sim</option>
                        <option value="false">Não</option>
                    </select>
                </div> -->
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th style="width: 30px;">OS</th>
                            <th style="width: 40px;">Tipo de Manut.</th>
                            <th style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Setor</th>
                            <th style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Máq. ou Local</th>
                            <th>Risco</th>
                            <th>Status</th>
                            <th style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Natureza</th>
                            <th style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Últ. atualização</th>
                            <th style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Máq. Parada?</th>
                            <!-- <th style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Custo MO</th> -->
                            <th style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Menu</th>
                            <th style=" display: none; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Descricao</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in list_users %}
                        <tr>
                            <td data-title="OS" class="colunaOs" style="padding-bottom: 0px; overflow: hidden; text-overflow: d; white-space: nowrap;">{{row[11]}}</td>
                            {% if row[17] != '' %}
                            <td data-title="Tipo Manutenção" class="colunaExec" style="padding-bottom: 0px; overflow: hidden; text-overflow: d; white-space: nowrap;">{{row[17]}}</td>
                            {% else %}
                            <td data-title="Tipo Manutenção" class="colunaExec" style="padding-bottom: 0px; overflow: hidden; text-overflow: d; white-space: nowrap; color: transparent;">Não Informado</td>
                            {% endif %}
                            <td data-title="Setor" class="colunaSetor" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ row[2] }}</td>
                            <td data-title="Maquina" class="colunaMaquina" style="padding-bottom: 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{row[3]}}</td>
                            <td data-title="Risco" style="padding-bottom: 0px;">{{row[4]}}</td>
                            {% if row[5] == 'Finalizada' %}
                            <td data-title="Status" class="colunaStatus" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span class="flag-finalizado">Finalizada</span>
                            </td>
                            {% elif row[5] == 'Em execução' %}
                            <td data-title="Status" class="colunaStatus" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span class="flag-em-execucao">Em execução</span>
                            </td>
                            {% elif row[5] == 'Aguardando material' %}
                            <td data-title="Status" class="colunaStatus" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span class="flag-aguardando">Aguardando material</span>
                            </td>
                            {% elif row[5] == 'Aguardando OK' %}
                            <td data-title="Status" class="colunaStatus" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span class="flag-aguardando-OK">Aguardando OK</span>
                            </td>
                            {% else %}
                            <td data-title="Status" class="colunaStatus" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span class="flag-em-espera">Em espera</span>
                            </td>    
                            {% endif %}

                            <td data-title="Natureza" style="padding-bottom: 0px;">{{row[16]}}</td>
                            <td data-title="Abertura" style="padding-bottom: 0px;">{{row[20]}}</td>
                            
                            {% if row[19] == True %}
                            <td data-title="Máquina Parada?" style="padding-bottom: 0px;"><i class="fas fa-check-circle habilitado"></i></td>
                            {% else %}
                            <td data-title="Máquina Parada?" style="padding-bottom: 0px;"><i class="fas fa-times-circle desabilitado"></i></td>
                            {% endif %}                            
                            <td>
                                <div class="row">
                                    <div class="col-sm-4 d-flex justify-content-center align-items-center" style="padding-left: 0.35rem;">
                                        <!-- <button class="btn" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> -->
                                        <a class="dropdown-item dropdown_os dropdownsss" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor: pointer;">
                                            <i class="fas fa-plus"></i>
                                        </a>
                                        <!-- </button> -->
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                            <a id="dropdown_os_1" class="dropdown-item dropdown_os" style="cursor: pointer;" onclick="modalExecucao('{{ row[11] }}')"> 
                                                <i class="fas fa-wrench"></i> Execução
                                            </a>
                                            <!-- <a class = "dropdown-item dropdown_os dropdownsss" href="/edit_material/{{row[11]}}" class="btn"> 
                                                <i class="fas fa-box"></i> 
                                            </a> -->
                                            <a class = "dropdown-item dropdown_os dropdownsss" style="cursor: pointer;" onclick="modalTimeline('{{ row[11] }}')" class="btn"> 
                                                <i class="fas fa-clock"></i> Histórico 
                                            </a>
                                            <!-- <a class="dropdown-item dropdown_os dropdownsss" title='Imagem' style="cursor: pointer;" onclick="showImageModal('{{ row[11] }}')">
                                                <i class="fas fa-image"></i> 
                                            </a> -->
                                            <!-- <a class="dropdown-item dropdown_os dropdownsss" style="cursor: pointer;" href="/visualizar_pdf/{{row[11]}}" target="_blank">
                                            <i class="far fa-file-pdf"></i> Arquivo
                                            </a> -->
                                            <!-- <a class="dropdown-item dropdown_os dropdownsss" href="/editar_ordem_inicial/{{row[11]}}/{{0}}"> 
                                                <i class="fas fa-pencil"></i> 
                                            </a> -->
                                            <a class = "dropdown-item dropdown_os dropdownsss" style="cursor: pointer;" onclick="modalExcluirOrdem('{{ row[11] }}')" class="btn"> 
                                                <i class="fas fa-trash"></i> Excluir 
                                            </a>
                                        </div>
                                    </div>
                                    {% if row[38] != '' %}
                                    <div class="col-sm-4 d-flex justify-content-center align-items-center" style="padding-left: 0.35rem;">
                                        
                                        <a class="dropdown-item dropdown_os dropdownsss" title='Imagem' style="cursor: pointer;" onclick="showImageModal('{{ row[11] }}')">
                                            <i class="fas fa-image"></i> 
                                        </a>
                                        
                                    </div>
                                    {% endif %}
                                    {% if row[37] != '' %}
                                    <div class="col-sm-4 d-flex justify-content-center align-items-center" style="padding-left: 0.35rem;">
                                        
                                        <a class="dropdown-item dropdown_os dropdownsss" title='Video' style="cursor: pointer;" onclick="showVideoModal('{{ row[11] }}')">
                                            <i class="fas fa-camera-retro"></i>
                                        </a>
                                        
                                    </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td data-title="Descricao" style="display: none; padding-bottom: 0px;">{{row[6]}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<!-- /.container-fluid -->

<!-- Modal execução -->
<div class="modal fade" data-backdrop="static" id="modalExecucao" tabindex="-1" role="dialog" aria-labelledby="modalExecucaoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- <h5 class="modal-title" id="modalExecucaoLabel">Execução da </h5> -->
                <h5 class="modal-title" id="numeroOrdem">texto</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="height: 700px; overflow-y: auto;">
                <h6 class="m-0 font-weight-bold text-primary">Informações gerais</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label for="setor">Setor:</label>
                        <input type="text" name="setor" id="setor" value="" class="form-control" readonly="readonly">    
                    </div>
                    <div class="col-sm-6">
                        <label for="setor">Solicitante:</label>
                        <input id="inputSolicitante" type="text" name="solicitante" value="" class="form-control" readonly="readonly">    
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 mb-2">
                        <label>Data Abertura:</label>
                        <input id="dataAbertura" type="text" name="dataAbertura" value="" class="form-control" readonly="readonly">
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label>N° execução:</label>
                        <input type="text" id="n_ordem" name="n_ordem" value="" class="form-control" readonly="readonly">
                    </div>
                    <div class="col-sm-4">
                        <label>Risco:</label>
                        <input id="inputRisco" type="text" name="risco" value="" class="form-control" readonly="readonly"> 
                    </div>
                </div>
                <hr>
                <h6 class="m-0 font-weight-bold text-primary">Máquina</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label for="maquina">Máquina ou Local:</label>
                        <input type="text" name="maquina" id="maquina"  value="" class="form-control" readonly="readonly">
                    </div>
                    <div class="col-sm-6">
                        <label for="tombamento">Tombamento</label>
                        <input id="inputTombamento" type="text" name="tombamento" value="" class="form-control" readonly="readonly" >
                    </div>
                </div>
                <div id="camposSolda" style="display: none;">
                    <div class="row">
                        <div class="col-sm-6 mb-2">
                            <div id="equipamento_em_falha">
                                <label>Equipamento em falha:</label>
                                <input id="inputEquipamentoEmFalha" type="text" name="equipamento_em_falha" value="" class="form-control" readonly="readonly">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div id="codigo_equipamento">
                                <label>Código do Equipamento:</label>
                                <input id="codigoEquipamento" type="text" name="cod_equipamento" value="" class="form-control" readonly="readonly">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 mb-2">
                            <div id="setor_maquina_solda">
                                <label>Setor da máq. de solda:</label>
                                <input id="setorMaqSolda" type="text" name="input_setor_maquina_solda" value="" class="form-control" readonly="readonly">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div id="ferramenta">
                                <label>Qual ferramenta:</label>
                                <input id="qual_ferramenta" type="text" name="qual_ferramenta" value="" class="form-control" readonly="readonly">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 mb-2">
                        <label for="problema">Descrição do usuário:</label>
                        <textarea id="problema" class="form-control" name="problema" rows="5" cols="41" required readonly="readonly"></textarea >
                    </div>
                </div>
                <div id="camposEte" style="display: none;">
                    <hr>
                    <h6 class="m-0 font-weight-bold text-primary">ETE</h6>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3 mb-2">
                            <label for="pvlye">PVLYE (L)</label>
                            <input id="pvlye" class="form-control" type="text" name="pvlye" value="">
                            <small id="pvlye" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3 mb-2">
                            <label for="pa-plus">PA PLUS (L)</label>
                            <input id="pa-plus" class="form-control" type="text" name="pa-plus" value="">
                            <small id="pa-plus" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3 mb-2">
                            <label for="tratamento">Tratamento Eficaz?</label>
                            <select class="form-control" name="tratamento" id="tratamento" value="">
                                <option value="" selected disabled hidden></option>
                                <option>Sim</option>
                                <option>Não</option>
                            </select>
                            <small id="tratamento" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3">
                            <label for="ph-agua">PH Água</label>
                            <input class="form-control" type="text" name="ph-agua" id="ph-agua" value="">
                            <small id="ph-agua" class="form-text text-muted">Obrigatório</small>
                        </div>
                    </div>
                </div>
                <hr>
                <h6 class="m-0 font-weight-bold text-primary">Execução</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label>Tipo de manutenção</label>
                        <select style = 'height: 50px;' class="form-control" name="tipo_manutencao" id="selectTipoManutencao">
                            <option value="" selected disabled hidden></option>  
                            <option value="Corretiva">Corretiva</option>
                            <option value="Preventiva">Preventiva</option>
                            <option value="Preditiva">Preditiva</option>
                            <option value="Apoio">Apoio</option>
                            <option value="Projetos">Projetos</option>
                            <option value="sesmt">SESMT</option>  
                            <option value="Corretiva Programada">Corretiva Programada</option>  
                        </select>
                        <small id="selectTipoManutencao" class="form-text text-muted">Obrigatório</small>
                    </div>
                    <div class="col-sm-6">
                        <label>Área de manutenção</label>
                        <select style = 'height: 50px;' class="form-control" name="area_manutencao" id="areaManutencao">
                            <option value="" selected disabled hidden></option>  
                            <option value="Predial">Predial</option>
                            <option value="Mecânica">Mecânica</option>
                            <option value="Elétrica">Elétrica</option>
                        </select>  
                        <small id="areaManutencao" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label for="statusLista">Data e hora</label>
                        <input id="data_edit" class="form-control" type="text" name="datetimes" />
                        <small id="data_edit" class="form-text text-muted">Obrigatório</small>
                    </div>
                    <div class="col-sm-6">
                        <label for="operador_label">Operadores</label>
                        <!-- <select class="form-control" id="operador" name="operador" multiple required> -->
                        <select class="form-control js-example-basic-multiple" multiple="multiple" style="width: 100%" id="operador">
                            {% for funcionario in funcionarios %}
                                <option>{{funcionario[0]}}</option>
                            {% endfor %}
                        </select>
                        <small id="operador" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label for="descmanutencao">Observação da manutenção:</label>
                        <textarea id="descmanutencao" class="form-control" name="descmanutencao" rows="5" cols="41"></textarea>
                        <small id="descmanutencao" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label for="statusLista">Status</label>
                        <select class="form-control" id="statusLista" name="statusLista">
                            
                        </select>
                    </div>
                </div>
                <div class="row" id="linhaMaquinaParada" style="display: none;">
                    <div class="col-sm-12">
                        <label for="maquina-realmente-parada">Máquina está parada?</label>
                        <input type="checkbox" name="maquina-parada-1" id="maquina-parada-1" value="true"> 
                    </div>
                </div>
                <div class="row" id="linhaExecucaoFeitaMaquinaParada" style="display: none;">
                    <div class="col-sm-12">
                        <label for="execucao-maquina-parada">Execução feita c/ a máquina parada?</label>
                        <input type="checkbox" name="maquina-parada-2" id="maquina-parada-2" value="true">
                    </div>
                </div>
                <div class="row" id="linhaAposExecucao" style="display: none;">
                    <div class="col-sm-12">
                        <label for="apos-execucao-maquina-parada">Após a execução, a máquina está funcionando?</label>
                        <input type="checkbox" name="maquina-parada-3" id="maquina-parada-3" value="true">
                    </div>
                </div>
                <div class="row" id="linhaLimpezaLocal" style="display: none;"> 
                    <div class="col-sm-12">
                        <label for="limpeza">Limpeza no local?</label>
                        <input type="checkbox" name="limpeza-local" id="limpeza-local" value="true"><small style="display: inline;" class="form-text text-muted"> Obrigatório</small>
                    </div>
                </div>
                <div class="row" id="linhaProtecoes" style="display: none;">
                    <div class="col-sm-12">
                        <label for="protec">Proteções?</label>
                        <input type="checkbox" name="protecao-local" id="protecao-local" value="true"><small style="display: inline;" class="form-text text-muted"> Obrigatório</small>
                    </div>
                </div>
                <div class="row" id="linhaFuncionalidadeEquipamento" style="display: none;">
                    <div class="col-sm-12">
                        <label for="funcionalidade">Funcionalidade do equipamento?</label>
                        <input type="checkbox" name="funcionalidade-equipamento" id="funcionalidade-equipamento" value="true"><small style="display: inline;" class="form-text text-muted"> Obrigatório</small>
                    </div>
                </div>
            </div> 
            <div class="modal-footer">
                <button id="salvar_edicao" type="submit" class="btn btn-primary btn-block">Salvar</button>
                <button id="ok_edicao" type="submit" class="btn btn-primary btn-block" style="display: none;">Ok</button>
            </div>
        </div>
    </div>
    <div id="divMaquinasPreventivas" style="display: none;"><input type="text" value="" id="inputMaquinasPreventivas"></div>
</div>

<!-- Modal timeline -->
<div class="modal fade" data-backdrop="static" id="modalTimeline" tabindex="-1" role="dialog" aria-labelledby="modalTimelineLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="m-0 font-weight-bold text-primary">Histórico</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="height: 700px; overflow-y: auto;">
                <div class="list-group" id="listaHistorico">
                    
                </div>
            </div>
            <div class="modal-footer">
                
            </div>
        </div>
    </div>
</div>

<!-- Modal edição de execução -->
<div class="modal fade" data-backdrop="static" id="modalEdicaoExecucao" tabindex="-1" role="dialog" aria-labelledby="modalEdicaoExecucaoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- <h5 class="modal-title" id="modalExecucaoLabel">Execução da </h5> -->
                <h5 class="modal-title" id="numeroOrdem_edicao">texto</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="height: 700px; overflow-y: auto;">
                <h6 class="m-0 font-weight-bold text-primary">Informações gerais</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label for="setor">Setor:</label>
                        <input type="text" name="setor" id="setor_edicao" value="" class="form-control" disabled>    
                    </div>
                    <div class="col-sm-6">
                        <label for="setor">Solicitante:</label>
                        <input id="inputSolicitante_edicao" type="text" name="solicitante" value="" class="form-control" disabled>    
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 mb-2">
                        <label>Data Abertura:</label>
                        <input id="dataAbertura_edicao" type="text" name="dataAbertura" value="" class="form-control" disabled>
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label>N° execução:</label>
                        <input type="text" id="n_ordem_edicao" name="n_ordem" value="" class="form-control" disabled>
                    </div>
                    <div class="col-sm-4">
                        <label>Risco:</label>
                        <input id="inputRisco_edicao" type="text" name="risco" value="" class="form-control"> 
                    </div>
                </div>
                <hr>
                <h6 class="m-0 font-weight-bold text-primary">Máquina</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label for="maquina">Máquina ou Local:</label>
                        <input type="text" name="maquina" id="maquina_edicao"  value="" class="form-control" disabled>
                    </div>
                    <div class="col-sm-6">
                        <label for="tombamento">Tombamento</label>
                        <input id="inputTombamento_edicao" type="text" name="tombamento" value="" class="form-control" readonly="readonly" >
                    </div>
                </div>
                <div id="camposSolda_edicao" style="display: none;">
                    <div class="row">
                        <div class="col-sm-6 mb-2">
                            <div id="equipamento_em_falha_edicao">
                                <label>Equipamento em falha:</label>
                                <input id="inputEquipamentoEmFalha_edicao" type="text" name="equipamento_em_falha" value="" class="form-control">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div id="codigo_equipamento_edicao">
                                <label>Código do Equipamento:</label>
                                <input id="codigoEquipamento_edicao" type="text" name="cod_equipamento" value="" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 mb-2">
                            <div id="setor_maquina_solda_edicao">
                                <label>Setor da máq. de solda:</label>
                                <input id="setorMaqSolda_edicao" type="text" name="input_setor_maquina_solda" value="" class="form-control">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div id="ferramenta_edicao">
                                <label>Qual ferramenta:</label>
                                <input id="qual_ferramenta_edicao" type="text" name="qual_ferramenta" value="" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 mb-2">
                        <label for="problema_edicao">Descrição do usuário:</label>
                        <textarea id="problema_edicao" class="form-control" name="problema" rows="5" cols="41" required readonly="readonly"></textarea >
                    </div>
                </div>
                <div id="camposEte_edicao" style="display: none;">
                    <hr>
                    <h6 class="m-0 font-weight-bold text-primary">ETE</h6>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3 mb-2">
                            <label for="pvlye_edicao">PVLYE (L)</label>
                            <input id="pvlye_edicao" class="form-control" type="text" name="pvlye" value="">
                            <small id="pvlye_edicao" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3 mb-2">
                            <label for="pa-plus_edicao">PA PLUS (L)</label>
                            <input id="pa-plus_edicao" class="form-control" type="text" name="pa-plus" value="">
                            <small id="pa-plus_edicao" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3 mb-2">
                            <label for="tratamento_edicao">Tratamento Eficaz?</label>
                            <select class="form-control" name="tratamento" id="tratamento_edicao" value="">
                                <option value="" selected disabled hidden></option>
                                <option>Sim</option>
                                <option>Não</option>
                            </select>
                            <small id="tratamento_edicao" class="form-text text-muted">Obrigatório</small>
                        </div>
                        <div class="col-sm-3">
                            <label for="ph-agua_edicao">PH Água</label>
                            <input class="form-control" type="text" name="ph-agua" id="ph-agua_edicao" value="">
                            <small id="ph-agua_edicao" class="form-text text-muted">Obrigatório</small>
                        </div>
                    </div>
                </div>
                <hr>
                <h6 class="m-0 font-weight-bold text-primary">Execução</h6>
                <hr>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label>Tipo de manutenção</label>
                        <select style = 'height: 50px;' class="form-control" name="tipo_manutencao" id="selectTipoManutencao_edicao">
                            <option value="" selected disabled hidden></option>  
                            <option value="Corretiva">Corretiva</option>
                            <option value="Preventiva">Preventiva</option>
                            <option value="Preditiva">Preditiva</option>
                            <option value="Apoio">Apoio</option>
                            <option value="Projetos">Projetos</option>
                            <option value="sesmt">SESMT</option>  
                            <option value="Corretiva Programada">Corretiva Programada</option>  
                        </select>
                        <small id="selectTipoManutencao_edicao" class="form-text text-muted">Obrigatório</small>
                    </div>
                    <div class="col-sm-6">
                        <label>Área de manutenção</label>
                        <select style = 'height: 50px;' class="form-control" name="area_manutencao" id="areaManutencao_edicao">
                            <option value="" selected disabled hidden></option>  
                            <option value="Predial">Predial</option>
                            <option value="Mecânica">Mecânica</option>
                            <option value="Elétrica">Elétrica</option>
                        </select>  
                        <small id="areaManutencao_edicao" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <label for="statusLista">Data e hora</label>
                        <input id="data_edit_edicao" class="form-control" type="text" name="datetimes" />
                        <small id="data_edit_edicao" class="form-text text-muted">Obrigatório</small>
                    </div>
                    <div class="col-sm-6">
                        <label for="operador_label">Operadores</label>
                        <!-- <select class="form-control" id="operador" name="operador" multiple required> -->
                        <select class="form-control js-example-basic-multiple" multiple="multiple" style="width: 100%" id="operador_edicao">
                            {% for funcionario in funcionarios %}
                                <option>{{funcionario[0]}}</option>
                            {% endfor %}
                        </select>
                        <small id="operador_edicao" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label for="descmanutencao_edicao">Observação da manutenção:</label>
                        <textarea id="descmanutencao_edicao" class="form-control" name="descmanutencao" rows="5" cols="41"></textarea>
                        <small id="descmanutencao_edicao" class="form-text text-muted">Obrigatório</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label for="statusLista">Status</label>
                        <select class="form-control" id="statusLista_edicao" name="statusLista">
                            <option>Aguardando material</option>
                            <option>Aguardando OK</option>
                            <option>Em espera</option>
                            <option>Finalizada</option>
                            <option>Em execução</option>
                        </select>
                    </div>
                </div>
            </div> 
            <div class="modal-footer">
                <button id="salvarEdicaoExecucao_edicao" type="submit" class="btn btn-primary btn-block">Salvar</button>
            </div>
        </div>
    </div>
    <!-- <div id="divMaquinasPreventivas" style="display: none;"><input type="text" value="" id="inputMaquinasPreventivas"></div> -->
</div>

<!-- Modal excluir ordem -->
<!-- <div id="modalEnviar" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span> 
        <form>
            <div>
                <label for="observacao">Motivo da exclusão da OS:</label>
                <textarea id="observacao" rows="4" cols="45" required></textarea>
            </div>
            <button class="enviarModal" type="submit" onclick="excluirOrdem()">Enviar</button>
        </form>
    </div>
</div> -->

<!-- Modal excluir ordem 2.0 -->

<div class="modal fade" data-backdrop="static" id="modalExcluirOrdem" tabindex="-1" role="dialog" aria-labelledby="modalExcluirOrdemLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="m-0 font-weight-bold text-primary">Excluir ordem</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label for="observacaoExcluirOrdem">Motivo da exclusão da OS:</label>
                <textarea class="form-control" id="observacaoExcluirOrdem" rows="4" cols="45" required></textarea>
            </div>
            <div class="modal-footer">
                <button id="buttonExcluirOrdem" class="btn btn-success" type="submit" onclick="excluirOrdem()">Enviar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Imagem -->
<div class="modal fade" id="imagemModal" tabindex="-1" role="dialog" aria-labelledby="imagemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imagemModalLabel">Fotos</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Aqui é onde a imagem será exibida -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Vídeo -->
<div class="modal fade" data-backdrop="static" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="videoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="videoModalLabel">Vídeos</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Aqui é onde o vídeo será exibido -->
            </div>
        </div>
    </div>
</div>

<!-- Identificador Logado -->
<div id="identificador_logado" style="display: none;"><input type="text" value="{{identificador_selecionado}}" id="inputIdentificadorLogado"></div>

<div id="mensagem"></div>

<div id="overlay"></div>
<div class="spinner-grow text-dark" role="status" id="spinner" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
  <span class="sr-only">Loading...</span>
</div>

{% endblock %}

{% block scripts %}

<!-- Core plugin JavaScript-->
<script src="static/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Page level plugins -->
<script src="static/vendor/datatables/jquery.dataTables.min.js"></script>
<script src="static/vendor/datatables/dataTables.bootstrap4.min.js"></script>

<!-- Page level custom scripts -->
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="static/js/demo/datatables-demo.js"></script>

<!-- Bootstrap core JavaScript-->
<script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>

    function downloadFilteredCSV(filteredData) {
        // Adicione uma linha de cabeçalho com os nomes das colunas
        var headerRow = ['OS', 'Execução','Setor', 'Máquina', 'Risco', 'Status', 'Natureza', 'Abertura', 'Máq. Parada?', 'Custo MO', 'Menu','Descricao'];
        filteredData.unshift(headerRow);
        var csvContent = "data:text/csv;charset=utf-8,";

        // Concatena todas as linhas em uma única string
        for (var i = 0; i < filteredData.length; i++) {
            var cleanedRow = filteredData[i].map(cleanCSVValue).join(",");
            csvContent += cleanedRow + "\r\n"; // Usamos "\r\n" para forçar a quebra de linha no formato CSV
        }

        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "dados_filtrados.csv");
        document.body.appendChild(link);
        link.click();
    }

    function cleanCSVValue(value) {
        // Limpa o valor removendo quebras de linha e espaços extras
        return value.replace(/[\r\n]+/g, '').trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function downloadFilteredData() {
        var filteredData = applyFilters(); // Aplica os filtros e obtém os dados filtrados
        console.log(filteredData);
        // downloadFilteredCSV(filteredData)
    }

    function applyFilters() {

        $('#dataTable').DataTable().destroy();

        // Obtém os valores dos filtros
        var osFilterValue = osFilter.value.toLowerCase();
        var execucaoFilterValue = execucaoFilter.value.toLowerCase();
        var setorFilterValue = setorFilter.value.toLowerCase();
        var maquinaFilterValue = maquinaFilter.value.toLowerCase();
        var riscoFilterValue = riscoFilter.value.toLowerCase();
        var statusFilterValue = statusFilter.value.toLowerCase();
        var naturezaFilterValue = naturezaFilter.value.toLowerCase();
        var aberturaFilterValue = aberturaFilter.value.toLowerCase();
        // var maquinaParadaFilterValue = maquinaParadaFilter.value.toLowerCase();

        // Obtém a tabela
        var table = $('#dataTable').DataTable({
            order: [[7, 'desc']],
            responsive: true,
            columnDefs: [
                // { responsivePriority: 10001, targets: 0 },
                { responsivePriority: 10001, targets: 1 },
                // { responsivePriority: 1, targets: 3 },
                { responsivePriority: 1, targets: -2 },
            ]
        });

        // Aplica a filtragem para cada coluna
        table.columns(0).search(osFilterValue).draw();
        table.columns(1).search(execucaoFilterValue).draw();
        table.columns(2).search(setorFilterValue).draw();
        table.columns(3).search(maquinaFilterValue).draw();
        table.columns(4).search(riscoFilterValue).draw();
        table.columns(5).search(statusFilterValue).draw();
        table.columns(6).search(naturezaFilterValue).draw();
        table.columns(7).search(aberturaFilterValue).draw();
        // table.columns(8).search(maquinaParadaFilterValue).draw();

        // Atualiza a exibição da linha conforme necessário
        table.rows().every(function () {
            var shouldDisplay =
                this.data()[0].toLowerCase().includes(osFilterValue) &&
                this.data()[1].toLowerCase().includes(execucaoFilterValue) &&
                this.data()[2].toLowerCase().includes(setorFilterValue) &&
                this.data()[3].toLowerCase().includes(maquinaFilterValue) &&
                this.data()[4].toLowerCase().includes(riscoFilterValue) &&
                this.data()[5].toLowerCase().includes(statusFilterValue) &&
                this.data()[6].toLowerCase().includes(naturezaFilterValue) &&
                this.data()[7].toLowerCase().includes(aberturaFilterValue)
                // this.data()[8].toLowerCase().includes(maquinaParadaFilterValue);

            this.node().style.display = shouldDisplay ? '' : 'none';
        });

        var visibleRows = table.rows({ search: 'applied' }).data().toArray();

        // Retorna os dados filtrados
        return visibleRows;
    }

    // Obtém os elementos de filtro por seus IDs
    var osFilter = document.getElementById('os-filter');
    var execucaoFilter = document.getElementById('execucao-filter');
    var setorFilter = document.getElementById('setor-filter');
    var riscoFilter = document.getElementById('risco-filter');
    var maquinaFilter = document.getElementById('maquina-filter');
    var statusFilter = document.getElementById('status-filter');
    var naturezaFilter = document.getElementById('natureza-filter');
    var aberturaFilter = document.getElementById('abertura-filter')
    // var maquinaParadaFilter = document.getElementById('maquina-parada-filter');

    // Função para preencher o filtro de execução com valores únicos
    function populateExecucaoFilter() {
        var options = Array.from(new Set(Array.from(document.querySelectorAll('#execucao-filter option')).map(option => option.value)));
        var sortedValues = sortUniqueValues(options);

        var nonEmptyValues = sortedValues.filter(value => value !== "");

        execucaoFilter.innerHTML = '<option value="">Todos</option>';
        nonEmptyValues.forEach(value => {
            execucaoFilter.innerHTML += `<option value="${value}">${value}</option>`;
        });
    }

    // Adiciona event listeners para detectar mudanças nos filtros
    osFilter.addEventListener('input', applyFilters);
    execucaoFilter.addEventListener('change', applyFilters);
    setorFilter.addEventListener('change', applyFilters);
    riscoFilter.addEventListener('change', applyFilters);
    maquinaFilter.addEventListener('input', applyFilters);
    statusFilter.addEventListener('change', applyFilters);
    naturezaFilter.addEventListener('change', applyFilters);
    aberturaFilter.addEventListener('input', applyFilters);
    // maquinaParadaFilter.addEventListener('change', applyFilters);

    // Chama a função applyFilters inicialmente para exibir a tabela completa
    applyFilters();
    populateExecucaoFilter(); // Preenche o filtro de execução com valores únicos

    function sortUniqueValues(values) {
        return values.sort(function(a, b) {
            return a.localeCompare(b, 'pt', { sensitivity: 'base' });
        });
    }

</script>

<script>
    function modalExcluirOrdem(id_ordem) {
        $('#modalExcluirOrdem').modal('show');
        
        document.getElementById('buttonExcluirOrdem').addEventListener('click', function() {

            showLoading();

            var observacaoExclusao = document.getElementById('observacaoExcluirOrdem').value;

            if (!observacaoExclusao) {
                // Exibir uma mensagem de erro ou realizar alguma ação caso o campo esteja vazio
                exibirMensagem('aviso','Por favor, preencha o campo de observação.');
                hideLoading();
                return;
            }

            const dados = {
                id: id_ordem,
                texto: observacaoExclusao
            };

            $.ajax({
                type: 'POST', // ou 'GET' dependendo do seu backend
                url: 'excluir-ordem',
                data: JSON.stringify(dados),
                contentType: 'application/json',
                success: function(response) {
                    // Trata a resposta do servidor, se necessário
                    console.log(response);
                    exibirMensagem('sucesso','Salvo.')

                    $('#modalExcluirOrdem').modal('hide');
                    
                    location.reload();
                    
                    $('#dataTable').DataTable().destroy();

                    var table = $('#dataTable').DataTable({
                        order: [[7, 'desc']],
                        responsive: true,
                        columnDefs: [
                            // { responsivePriority: 10001, targets: 0 },
                            { responsivePriority: 10001, targets: 1 },
                            // { responsivePriority: 1, targets: 3 },
                            { responsivePriority: 1, targets: -2 },
                        ]
                    });

                    hideLoading();
                },
                error: function(error) {
                    // Trata erros aqui
                    hideLoading();
                    console.error('Erro na requisição AJAX:', error);
                    exibirMensagem('aviso','Preencha todos os campos obrigatórios.');
                    
                }
            });

        }); 
    }
</script>

<!-- <script>
    function excluirOrdem(id_ordem) {
        const enviarModalButton = document.querySelector('#modalEnviar .enviarModal');
        const idLinha = enviarModalButton.getAttribute('data-id-linha');
        const observacao = document.getElementById('observacao').value;

        if (!observacao) {
            // Exibir uma mensagem de erro ou realizar alguma ação caso o campo esteja vazio
            alert('Por favor, preencha o campo de observação.');
            return;
        }

        const dados = {
            id: idLinha,
            texto: observacao
        };

        fetch('/excluir-ordem', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        })
        .then(response => response.text())
        .then(data => {
            console.log(data); // Exemplo: imprime a resposta do backend no console
            location.reload();
        })
        .catch(error => {
            console.error('Erro:', error); // Tratamento de erro
            // Exiba uma mensagem de erro para o usuário
        });

        const modalEnviar = document.getElementById('modalEnviar');
        modalEnviar.style.display = 'none';
    }

</script> -->

<script>    
    function showImageModal(id_ordem) {
        showLoading();
        $.ajax({
            url: '/visualizar_midias/' + id_ordem,
            type: 'GET',
            dataType: 'json', // Adicione esta linha para indicar que o retorno é JSON
            success: function(response) {
                var imagens = response.imagens_data;
                var videos = response.videos_data;
                var modalBody = '';

                // Iterar sobre todas as imagens e adicionar ao modal
                for (var i = 0; i < imagens.length; i++) {
                    var base64Image = imagens[i];
                    modalBody += '<img class="img-thumbnail" src="data:image/png;base64,' + base64Image + '" alt="Imagem" /><br><br>';
                }

                // Preencher o conteúdo do modal com as imagens e vídeos
                $('#imagemModal .modal-body').html(modalBody);

                // Exibir o modal
                $('#imagemModal').modal('show');

                // Ocultar a tela de carregamento após um pequeno atraso (500 milissegundos)
                setTimeout(function() {
                    hideLoading(); // Esconde o indicador de carregamento
                }, 10);
            },
            error: function(error) {
                hideLoading();
                alert('Essa Ordem de Serviço não contém imagem ou vídeo');
                console.log(error);
            }
        });
    }
</script>

<script>
    // Obtém todas as células da coluna que contém os valores float (índice da coluna, começando em 0)
    var colunaValores = document.querySelectorAll('#table1 td.coluna-valores');

    // Percorre todas as células da coluna
    for (var i = 0; i < colunaValores.length; i++) {
    var valorCelula = colunaValores[i].textContent;

    // Remove caracteres não numéricos (exceto ponto decimal) da string
    var valorNumerico = valorCelula.replace(/[^\d.-]/g, '');

    // Converte o valor para float
    var valorFloat = parseFloat(valorNumerico);

    // Verifica se o valor é um número válido
    if (!isNaN(valorFloat)) {
        // Formata o valor como moeda
        var formatoMoeda = valorFloat.toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
        });

        // Atualiza o valor da célula com a moeda formatada
        colunaValores[i].textContent = formatoMoeda;
    }
    }
</script>

<script>
    function showVideoModal(id_ordem) {
        showLoading();
        $.ajax({
            url: '/visualizar_video/' + id_ordem,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                var videos = response.videos_data;
                var modalBody = '';

                // Iterar sobre todos os vídeos e adicionar ao modal
                for (var i = 0; i < videos.length; i++) {
                    var videoURL = videos[i];
                    modalBody += '<video controls>';
                    modalBody += '<source src="' + videoURL + '" type="video/mp4">';
                    modalBody += 'Seu navegador não suporta o elemento de vídeo.';
                    modalBody += '</video><br><br>';
                }

                // Preencher o conteúdo do modal com os vídeos
                $('#videoModal .modal-body').html(modalBody);

                // Exibir o modal
                $('#videoModal').modal('show');

                // Ocultar a tela de carregamento após um pequeno atraso (500 milissegundos)
                setTimeout(function() {
                    hideLoading();
                }, 10);
            },
            error: function(error) {
                hideLoading();
                alert('Ocorreu um erro ao buscar os vídeos');
                console.log(error);
            }
        });
    }
</script>

<!-- Script para mostrar ou esconder perguntas dependendo do login e máquina -->
<script>

    $(document).ready(function() {
        
        // Event handler for status dropdown change
        $('#statusLista').on('change', function() {
            var selectedStatus = $(this).val();
            var nOrdem = parseInt($('#n_ordem').val());
            var maquinaValue = $('#maquina').val(); // Obter o valor da máquina
            var maquinas_preventivas = $('#inputMaquinasPreventivas').val();// boolean
            var identificador_logado = $('#inputIdentificadorLogado').val();
    
            updateToggleVisibility(selectedStatus, nOrdem, maquinaValue,maquinas_preventivas,identificador_logado);
        });
    
        // Update toggle visibility on page load
        var selectedStatus = $('#statusLista').val();
        console.log(selectedStatus);
        var nOrdem = parseInt($('#n_ordem').val());
        var maquinaValue = $('#maquina').val(); // Obter o valor da máquina
        var maquinas_preventivas = $('#inputMaquinasPreventivas').val(); // boolean
        // var identificador_logado = $('.identificador_logado').val();
        var identificador_logado = $('#inputIdentificadorLogado').val();

        updateToggleVisibility(selectedStatus, nOrdem, maquinaValue,maquinas_preventivas,identificador_logado);
    
    });
    
    function updateToggleVisibility(status, nOrdem, maquinaValue,maquinas_preventivas,identificador_logado) {
        
        var maquinas_preventivas = document.getElementById('inputMaquinasPreventivas').value;
        var identificador_logado = $('#inputIdentificadorLogado').val();

        console.log(status, nOrdem, maquinaValue,maquinas_preventivas,identificador_logado);

        if (status !== 'Aguardando OK' && identificador_logado === "2") {
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').hide();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
            $('#ok_edicao').hide();
        }else if  (maquinaValue === 'ETE' || identificador_logado === "2") {
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').hide();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        }else if (status === 'Finalizada' && maquinas_preventivas === 'true' && nOrdem > 0){
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').show();
            $('#linhaProtecoes').show();
            $('#linhaFuncionalidadeEquipamento').show();
        }else if (status === 'Aguardando OK'){
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').hide();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
            $('#salvar_edicao').hide();
        }else if (nOrdem === 1 && status === 'Finalizada') {
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        } else if (nOrdem === 2 && status === 'Finalizada') {
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        } else if (status === 'Finalizada') {
            $('#linhaMaquinaParada').hide();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').hide();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
            $('#salvar_edicao').show();
        } else if (nOrdem === 1) {
            $('#linhaMaquinaParada').show();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').show();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        } else if (nOrdem === 2) {
            $('#linhaMaquinaParada').show();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').show();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        } else {
            $('#linhaMaquinaParada').show();
            $('#linhaExecucaoFeitaMaquinaParada').show();
            $('#linhaAposExecucao').show();
            $('#linhaLimpezaLocal').hide();
            $('#linhaProtecoes').hide();
            $('#linhaFuncionalidadeEquipamento').hide();
        }
    }

</script>

<script src="static/js/formatar-data.js"></script>

<!-- Abertura do modal de execução -->
<script>
    function modalExecucao(id_ordem) {
        showLoading();

        $.ajax({
            url: '/dados-ordem-servico',
            type: 'POST',  // Alterado para POST
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({ 'id_ordem': id_ordem }),  // Enviando um objeto JSON
            success: function(response) {
                
                // verificarEstadoBotao();

                $('#modalExecucao').modal('show');

                $("#operador").val([]).change(); // Define o valor do select para vazio

                document.getElementById('numeroOrdem').innerText = id_ordem;
                
                if (response.setor_values === 'Solda') {
                    // Se response.setor_values for 'Solda', mostrar a div
                    $('#camposSolda').show();
                } else {
                    // Caso contrário, ocultar a div
                    $('#camposSolda').hide();
                }

                if (response.maquina === 'ETE') {
                    // Se response.setor_values for 'Solda', mostrar a div
                    $('#camposEte').show();
                } else {
                    // Caso contrário, ocultar a div
                    $('#camposEte').hide();
                }

                $('#setor').val(response.setor_values);
                $('#inputSolicitante').val(response.solicitante);
                $('#dataAbertura').val(formatarDataBr(response.data_abertura));
                $('#n_ordem').val(response.n_execucao);
                $('#maquina').val(response.maquina);
                $('#inputTombamento').val(response.tombamento);
                $('#inputEquipamentoEmFalha').val(response.equipamento_em_falha);
                $('#codigoEquipamento').val(response.codigo_equipamento);
                $('#setorMaqSolda').val(response.setor_maquina_solda);
                $('#qual_ferramenta').val(response.qual_ferramenta);
                $('#inputRisco').val(response.risco);
                $('#problema').val(response.desc_usuario);
                $('#inputMaquinasPreventivas').val(response.preventiva);

                console.log(response);

                // Populando select de tipo de manutencao e area de manutencao
                var statusTipoManutencao = response.tipo_manutencao;
                var statusAreaManutencao = response.area_manutencao;
                var statusSelecionado = response.status;

                // Iterar sobre as opções do select
                $('#selectTipoManutencao option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusTipoManutencao) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                // Iterar sobre as opções do select
                $('#areaManutencao option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusAreaManutencao) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                $('#statusLista').empty();

                // Loop pelos dados e adicionar opções à lista
                for (var i = 0; i < response.opcoes.length; i++) {
                    var opcao = response.opcoes[i];
                    $('#statusLista').append($('<option>', {
                        value: opcao,
                        text: opcao
                    }));
                }

                // Iterar sobre as opções do select
                $('#statusLista option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusSelecionado) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                // Exibir o conteúdo no console
                var identificadorSelecionado = $('#inputIdentificadorLogado').val()

                updateToggleVisibility(response.status,response.n_execucao,response.maquina,response.preventiva,identificadorSelecionado);

                hideLoading();

            },
            error: function(error) {
                // hideLoading();
                alert('Ocorreu um erro ao buscar os vídeos');
                console.log(error);
                hideLoading();
            }
        });
    }

</script>

<!-- Scripts de datarange  -->
<script>
    $(function() {
        $('input[name="datetimes"]').daterangepicker({
            parentEl: '#modalExecucao',
            timePicker: true,
            timePicker24Hour: true,
            startDate: moment().startOf('hour'),
            endDate: moment().startOf('hour').add(32, 'hour'),
            locale: {
            format: 'DD/MM/YYYY H:mm'
            }
        });
      
        $('input[name="datetimes"]').on('apply.daterangepicker', function(ev, picker) {
          var startDate = picker.startDate;
          var endDate = picker.endDate;
      
          if (endDate.isBefore(startDate)) {
            alert("A data final não pode ser menor que a data inicial");
            picker.setEndDate(startDate);
          }
        });
      });
</script>  
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<!-- Script para verificar se o botão de salvar vai desabilitar ou não -->
<script>
    $(document).ready(function() {
        // Função para verificar o estado do botão
        function verificarEstadoBotao() {
            var maquinas_preventivas = $('#inputMaquinasPreventivas').val();
            var status = $('#statusLista').val();
            var limpeza = $('#limpeza-local').prop('checked');
            var protecao = $('#protecao-local').prop('checked');
            var funcionalidade = $('#funcionalidade-equipamento').prop('checked');

            // Habilitar ou desabilitar o botão com base nas condições
            if (status === 'Finalizada' && limpeza && protecao && funcionalidade && maquinas_preventivas === 'true') {
                $('#salvar_edicao').prop('disabled', false);
            } else if(status === 'Finalizada' && maquinas_preventivas === 'false') {
                $('#salvar_edicao').prop('disabled', false);
            } else if(status !== 'Finalizada') {
                $('#salvar_edicao').prop('disabled', false);
            } else{
                $('#salvar_edicao').prop('disabled', true);
            }
        }

        // Associar a função ao evento de mudança do statusLista e dos checkboxes
        $('#statusLista, #limpeza-local, #protecao-local, #funcionalidade-equipamento').change(verificarEstadoBotao);

        // Inicialmente, verificar o estado do botão
        verificarEstadoBotao();
    });
</script>

<!-- Botão de salvar execução -->
<script>
    $('#salvar_edicao').on('click', function() {
        
        showLoading();

        $('#salvar_edicao').prop('disabled', false);

        var tipoManutencao =  document.getElementById('selectTipoManutencao').value;
        var areaManutencao =  document.getElementById('areaManutencao').value;
        var observacao =  document.getElementById('descmanutencao').value;
        var operadorSelecionado = $('#operador option:selected').length;

        if (tipoManutencao === '' | areaManutencao === '' | observacao === '' | operadorSelecionado === 0) {
            exibirMensagem('aviso','Preencha todos os campos obrigatórios.');
            return;
        }

        // Lista de IDs dos elementos que são checkboxes
        var idsCheckboxes = [
            'maquina-parada-1',
            'maquina-parada-2',
            'maquina-parada-3',
            'limpeza-local',
            'protecao-local',
            'funcionalidade-equipamento'
        ];

        // Objeto para armazenar os dados
        var dados = {};

        // Loop através dos IDs dos checkboxes
        idsCheckboxes.forEach(function(id) {
            // Obtém o estado de seleção do checkbox
            var estadoCheckbox = $('#' + id).is(':checked');
            // Atribui ao objeto dados
            dados[id] = estadoCheckbox;
        });

        // Lista de IDs dos elementos que não são checkboxes
        var idsNaoCheckboxes = [
            'setor',
            'inputSolicitante',
            'dataAbertura',
            'n_ordem',
            'inputRisco',
            'maquina',
            'inputEquipamentoEmFalha',
            'codigoEquipamento',
            'setorMaqSolda',
            'qual_ferramenta',
            'problema',
            'pvlye',
            'pa-plus',
            'tratamento',
            'ph-agua',
            'selectTipoManutencao',
            'areaManutencao',
            'data_edit',
            'operador',
            'descmanutencao',
            'statusLista'
        ];

        // Loop através dos IDs dos elementos que não são checkboxes
        idsNaoCheckboxes.forEach(function(id) {
            // Atribui ao objeto dados
            dados[id] = $('#' + id).val();
        });

        var numeroOs = $('#numeroOrdem').text();

        dados.numeroOs = numeroOs;
        
        console.log(dados);

        // Envia os dados para o backend usando AJAX
        $.ajax({
            type: 'POST', // ou 'GET' dependendo do seu backend
            url: 'executar-ordem',
            data: JSON.stringify(dados),
            contentType: 'application/json',
            success: function(response) {
                // Trata a resposta do servidor, se necessário
                console.log(response);
                exibirMensagem('sucesso','Salvo.')

                $('#descmanutencao').val(''); // Define o valor do select para vazio

                $('#modalExecucao').modal('hide');
                
                hideLoading();
            },
            error: function(error) {
                // Trata erros aqui
                hideLoading();
                console.error('Erro na requisição AJAX:', error);
                exibirMensagem('aviso','Preencha todos os campos obrigatórios.');
                
            }
        });
        
    });
</script>

<!-- Scripts para select2 dos operadores -->
<script>
    $(document).ready(function() {
        $('.js-example-basic-multiple').select2();
    });
    
</script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Abertura modal de timeline  -->
<script>
    function modalTimeline(id_ordem) {
        
        showLoading();

        $.ajax({
            url: '/timeline',
            type: 'POST',  // Alterado para POST
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({ 'id_ordem': id_ordem }),  // Enviando um objeto JSON
            success: function(response) {
                // Limpar conteúdo atual da lista
                $('#listaHistorico').empty();

                $('#modalTimeline').modal('show');

                // Seus dados fornecidos
                var dados = response[1]; // Certifique-se de ajustar conforme a estrutura real da resposta
                console.log(dados);
                console.log(response);
                
                // Loop pelos dados e gerar elementos da lista
                for (var i = 0; i < dados.length; i++) {
                    var item = dados[i];
                    var listItem = document.createElement('a');
                    listItem.className = 'list-group-item list-group-item-action';
                    // listItem.href = '#';
                    listItem.setAttribute('aria-current', 'true');

                    if (item[0] === 0) {
                        var content = `
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">${item[1]}</h5>
                            <div class="d-flex flex-column align-items-end">
                                <small>${item[6]} minutos</small>
                                <small>R$ ${item[7]}</small>
                                <small>Exec.: ${item[0]}</small>
                            </div>
                        </div>
                        <p class="mb-1" style="font-size: small;"><strong>Abertura: </strong>${formatarDataBr(item[4])}</p>
                    `;
                    } else {
                        var content = `
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">${item[1]}</h5>
                            <div class="d-flex flex-column align-items-end">
                                <small>${item[6]} minutos</small>
                                <small>R$ ${item[7]}</small>
                                <small>Exec.: ${item[0]}</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1" style="font-size: small;"><strong>Início: </strong>${formatarDataBr(item[4])}</p>
                            </div> 
                            
                            <div class="col-md-6">
                                <p class="mb-1" style="font-size: small;"><strong>Fim: </strong>${formatarDataBr(item[5])}</p>
                            </div>
                        </div>                       
                    `;
                    }

                    listItem.innerHTML = content;
    
                    // Use addEventListener para lidar com o clique
                    (function(itemValue) {
                        listItem.addEventListener('click', function() {
                            itensParaEditar(id_ordem, itemValue);
                        });
                    })(item[0]);
                    
                    document.getElementById('listaHistorico').appendChild(listItem);
                }

                hideLoading();
            
            },
            error: function(error) {
                hideLoading();
                alert('Ocorreu um erro ao buscar os vídeos');
                console.log(error);
            }
        });
    }

    function itensParaEditar(id_ordem,n_ordem) {

        showLoading();

        $.ajax({
            url: '/dados-editar-ordem',
            type: 'POST',  // Alterado para POST
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({ 'id_ordem': id_ordem, 'n_ordem': n_ordem }),  // Enviando um objeto JSON
            success: function(response) {

                $('#modalEdicaoExecucao').modal('show');

                // console.log(response.setor_values);
                // verificarEstadoBotao();

                $("#operador").val([]).change(); // Define o valor do select para vazio

                document.getElementById('numeroOrdem_edicao').innerText = id_ordem;
                
                if (response.setor_values === 'Solda') {
                    // Se response.setor_values for 'Solda', mostrar a div
                    $('#camposSolda_edicao').show();
                    console.log("mostrar div solda");
                } else {
                    // Caso contrário, ocultar a div
                    $('#camposSolda_edicao').hide();
                }

                if (response.maquina === 'ETE') {
                    // Se response.setor_values for 'Solda', mostrar a div
                    $('#camposEte_edicao').show();
                } else {
                    // Caso contrário, ocultar a div
                    $('#camposEte_edicao').hide();
                }

                $('#setor_edicao').val(response.setor_values);
                $('#inputSolicitante_edicao').val(response.solicitante);
                $('#dataAbertura_edicao').val(formatarDataBr(response.data_abertura));
                $('#n_ordem_edicao').val(response.n_execucao);
                $('#maquina_edicao').val(response.maquina);
                $('#inputTombamento_edicao').val(response.tombamento);
                $('#inputEquipamentoEmFalha_edicao').val(response.equipamento_em_falha);
                $('#codigoEquipamento_edicao').val(response.codigo_equipamento);
                $('#setorMaqSolda_edicao').val(response.setor_maquina_solda);
                $('#qual_ferramenta_edicao').val(response.qual_ferramenta);
                $('#inputRisco_edicao').val(response.risco);
                $('#problema_edicao').val(response.desc_usuario);
                // $('#inputMaquinasPreventivas_edicao').val(response.preventiva);
                $('#descmanutencao_edicao').val(response.descmanutencao);
                $('#pvlye_edicao').val(response.pvlye);
                $('#pa-plus_edicao').val(response.paplus);
                $('#tratamento_edicao').val(response.tratamento);
                $('#ph-agua_edicao').val(response.phagua);

                // Populando select de tipo de manutencao e area de manutencao
                var statusTipoManutencao = response.tipo_manutencao;
                var statusAreaManutencao = response.area_manutencao;
                var statusSelecionado = response.status;
                var selectOperadores = response.operador;

                // Iterar sobre as opções do select
                $('#selectTipoManutencao_edicao option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusTipoManutencao) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                // Iterar sobre as opções do select
                $('#areaManutencao_edicao option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusAreaManutencao) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                // Iterar sobre as opções do select
                $('#statusLista_edicao option').each(function() {
                    // Comparar o valor da opção com o status desejado
                    if ($(this).val() == statusSelecionado) {
                        // Se houver correspondência, definir a opção como selecionada
                        $(this).prop('selected', true);
                    }
                });

                console.log(selectOperadores.length);

                if (selectOperadores.length > 0) {

                    // Selecionar o elemento select com o ID 'operador_edicao' e inicializar o Select2
                    var selectOperadorEdicao = $('#operador_edicao').select2();

                    // Iterar sobre a lista de valores selecionados
                    selectOperadores.forEach(function(operadoresSelecionados) {
                        // Iterar sobre as opções do Select2
                        selectOperadorEdicao.find('option').each(function() {
                            // Comparar o valor da opção com o valor desejado
                            if ($(this).val() === operadoresSelecionados) {
                                // Se houver correspondência, definir a opção como selecionada
                                $(this).prop('selected', true);
                                // Parar de iterar, pois a opção desejada já foi encontrada
                                return false;
                            }
                        });
                    });

                    // Atualizar o Select2 para refletir as mudanças
                    selectOperadorEdicao.trigger('change');
                }

                $('input[name="datetimes"]').daterangepicker({
                    timePicker: true,
                    timePicker24Hour: true,
                    startDate: moment(`${response.data_inicio} ${response.hora_inicio}`, 'YYYY-MM-DD HH:mm'),
                    endDate: moment(`${response.data_fim} ${response.hora_fim}`, 'YYYY-MM-DD HH:mm'),
                    locale: {
                        format: 'DD/MM/YYYY H:mm'
                    }
                });

                // Exibir o conteúdo no console
                var identificadorSelecionado = $('#inputIdentificadorLogado').val()

                updateToggleVisibility(response.status,response.n_execucao,response.maquina,response.preventiva,identificadorSelecionado);

                hideLoading();

            },
            error: function(error) {
                hideLoading();
                alert('Ocorreu um erro ao buscar os vídeos');
                console.log(error);
            }
        });
    }   

</script>

<!-- Botão de salvar edição -->
<script>
    $('#salvarEdicaoExecucao_edicao').on('click', function() {

        showLoading();

        var tipoManutencao =  document.getElementById('selectTipoManutencao_edicao').value;
        var areaManutencao =  document.getElementById('areaManutencao_edicao').value;
        var observacao =  document.getElementById('descmanutencao_edicao').value;
        var operadorSelecionado = $('#operador_edicao option:selected').length;

        if (tipoManutencao === '' | areaManutencao === '' | observacao === '' | operadorSelecionado === 0) {
            exibirMensagem('aviso','Preencha todos os campos obrigatórios.');
            return;
        }

        // Lista de IDs dos elementos que são checkboxes
        // var idsCheckboxes = [
        //     'maquina-parada-1',
        //     'maquina-parada-2',
        //     'maquina-parada-3',
        //     'limpeza-local',
        //     'protecao-local',
        //     'funcionalidade-equipamento'
        // ];

        // Objeto para armazenar os dados
        var dados = {};

        // // Loop através dos IDs dos checkboxes
        // idsCheckboxes.forEach(function(id) {
        //     // Obtém o estado de seleção do checkbox
        //     var estadoCheckbox = $('#' + id).is(':checked');
        //     // Atribui ao objeto dados
        //     dados[id] = estadoCheckbox;
        // });

        // Lista de IDs dos elementos que não são checkboxes
        var idsNaoCheckboxes = [
            'setor_edicao',
            'inputSolicitante_edicao',
            'dataAbertura_edicao',
            'n_ordem_edicao',
            'inputRisco_edicao',
            'maquina_edicao',
            'inputEquipamentoEmFalha_edicao',
            'codigoEquipamento_edicao',
            'setorMaqSolda_edicao',
            'qual_ferramenta_edicao',
            'problema_edicao',
            'pvlye_edicao',
            'pa-plus_edicao',
            'tratamento_edicao',
            'ph-agua_edicao',
            'selectTipoManutencao_edicao',
            'areaManutencao_edicao',
            'data_edit_edicao',
            'operador_edicao',
            'descmanutencao_edicao',
            'statusLista_edicao'
        ];

        // Loop através dos IDs dos elementos que não são checkboxes
        idsNaoCheckboxes.forEach(function(id) {
            // Atribui ao objeto dados
            dados[id] = $('#' + id).val();
        });

        var numeroOs = $('#numeroOrdem_edicao').text();

        dados.numeroOs = numeroOs;
        
        console.log(dados);

        // Envia os dados para o backend usando AJAX
        $.ajax({
            type: 'POST', // ou 'GET' dependendo do seu backend
            url: 'guardar-ordem-editada',
            data: JSON.stringify(dados),
            contentType: 'application/json',
            success: function(response) {
                // Trata a resposta do servidor, se necessário
                console.log(response);
                exibirMensagem('sucesso','Salvo.')

                $('#modalEdicaoExecucao').modal('hide');

                hideLoading();
            },
            error: function(error) {
                // Trata erros aqui
                hideLoading();
                console.error('Erro na requisição AJAX:', error);
                exibirMensagem('aviso','Preencha todos os campos obrigatórios.');
            }
        });
        
    });
</script>


{% endblock %}