{% extends "user/layout.html" %}

{% block title %}
<title>Gráficos</title>
{% endblock %}

{% block containerFluid %}

<!-- Begin Page Content -->
<div class="container-fluid">

  <!-- Filtros -->

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Filtros Gráficos</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <label for="filtro_setor">Setor:</label>
          <select id="selectSetor" class="selectpicker form-control" name="filtro_setor" multiple
            title="Selecione o(s) setor(es)..." data-selected-text-format="count > 3">
            <option value="Qualidade">Qualidade</option>
            <option value="Solda">Solda</option>
            <option value="Corte e estamparia">Corte e estamparia</option>
            <option value="Almoxarifado">Almoxarifado</option>
            <option value="Pintura">Pintura</option>
            <option value="Manutenção">Manutenção</option>
            <option value="Usinagem">Usinagem</option>
            <option value="Equipamentos de Movimentação">Equipamentos de Movimentação</option>
            <option value="Utilidades">Utilidades</option>
            <option value="Forjaria">Forjaria</option>
            <option value="Administrativo">Administrativo</option>
            <option value="Carpintaria">Carpintaria</option>
            <option value="Forjaria">Forjaria</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="data_filtro">Mês:</label>
          <input type="text" class="form-control" id="inputDate1" name="datetimes" autocomplete="off">
        </div>
      </div>
      <div style="display: flex;justify-content: flex-end;gap: 20px;align-items: flex-start;margin-top: 20px;">
        <label for="maquinas-favoritas">Máquinas importantes</label>
        <label class="switch">
          <input type="checkbox" name="maquinas-favoritas" id="maquinas-favoritas" style="width: 20px;height: 20px;">
          <span class="slider round"></span>
        </label>
      </div>
      <button id="buttonFilter" type="submit" class="btn btn-primary">Filtrar</button>
    </div>
  </div>

  <!-- Page Heading -->
  <!-- <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Cards</h1>
</div> -->

  <!-- Cards -->

  <div class="row">
    <!-- Execução -->
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                Em Execução</div>
              <div id="statusExecucao" class="h5 mb-0 font-weight-bold text-gray-800"></div>
            </div>
            <div class="col-auto">
              <i class="fa-solid fa-play fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Em espera -->
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                Em Espera</div>
              <div id="statusEspera" class="h5 mb-0 font-weight-bold text-gray-800"></div>
            </div>
            <div class="col-auto">
              <i class="fa-solid fa-hourglass-start fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Finalizada -->
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                Finalizada</div>
              <div id="statusFinalizada" class="h5 mb-0 font-weight-bold text-gray-800"></div>
            </div>
            <div class="col-auto">
              <i class="fa-solid fa-clipboard-check fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Aguardando material -->
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-secondary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                Aguardando Material</div>
              <div id="statusAguardando" class="h5 mb-0 font-weight-bold text-gray-800"></div>
            </div>
            <div class="col-auto">
              <i class="fa-solid fa-business-time fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Disponibilidade -->
  <div class="row">

    <!-- Disponibilidade -->

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                Disponibilidade Geral</div>
              <div id="cardDisponibilidade" class="h5 mb-0 font-weight-bold text-gray-800"></div>
            </div>
            <div class="col-auto">
              <i class="fa-solid fa-globe fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- MTBF de máquina -->

  <div class="row">

    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTBF por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico1"></canvas>
          </div>
          <hr>
          <code>MTBF – (Tempo Médio entre Falhas) por máquina </code> é a média do tempo decorrido entre falhas de uma
          máquina específica.
        </div>
      </div>
    </div>

    <!-- DataTales Example -->
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTBF por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable2" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Máquina</td>
                  <td>MTBF</td>
                </tr>
              </thead>
              <tbody id="tabelaBody2">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Top 10 menores - MTBF por máquina -->

  <div class="row">

    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Top 10 menores - MTBF por máquina</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico1top10"></canvas>
          </div>
          <hr>
          <code>MTBF – (Tempo Médio entre Falhas) por máquina </code> é a média do tempo decorrido entre falhas de uma
          máquina específica.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Top 10 - MTBF por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable3" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Máquina</td>
                  <td>MTBF</td>
                </tr>
              </thead>
              <tbody id="tabelaBody3">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MTBF por setor -->

  <div class="row">

    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTBF por setor</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico2"></canvas>
          </div>
          <hr>
          <code>MTBF – (Tempo Médio entre Falhas) por setor </code> é a média do tempo entre falhas para todos os
          equipamentos em um setor específico.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTBF por setor</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable4" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Setor</td>
                  <td>MTBF</td>
                </tr>
              </thead>
              <tbody id="tabelaBody4">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MTTR por Máquina -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTTR por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico3"></canvas>
          </div>
          <hr>
          <code>MTTR – (Tempo Médio de Reparação) por máquina </code> é a média do tempo necessário para reparar uma
          máquina específica após uma falha.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTTR por máquina</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable5" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Máquina</td>
                  <td>MTTR</td>
                </tr>
              </thead>
              <tbody id="tabelaBody5">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MTTR por Setor -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTTR por Setor</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico4"></canvas>
          </div>
          <hr>
          <code>MTTR – (Tempo Médio de Reparação) por Setor </code> é a média do tempo de reparo para todas as máquinas
          em um setor específico.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">MTTR por Setor</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable6" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Setor</td>
                  <td>MTTR</td>
                </tr>
              </thead>
              <tbody id="tabelaBody6">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Disponibilidade por Máquina -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Disponibilidade por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico5"></canvas>
          </div>
          <hr>
          <code>Disponibilidade por máquina </code> é uma métrica que expressa a proporção do tempo em que uma máquina
          está disponível para operação em relação ao tempo total.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Disponibilidade por Máquina</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable7" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Máquina</td>
                  <td>Disponibilidade</td>
                </tr>
              </thead>
              <tbody id="tabelaBody7">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Disponibilidade por Setor -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Disponibilidade por Setor</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico6"></canvas>
          </div>
          <hr>
          <code>Disponibilidade por Setor </code> considera a disponibilidade média de todas as máquinas em um setor
          específico.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Disponibilidade por Setor</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable8" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Setor</td>
                  <td>Disponibilidade</td>
                </tr>
              </thead>
              <tbody id="tabelaBody8">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Horas trabalhadas (tipo de manutenção) -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (tipo de manutenção)</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico7"></canvas>
          </div>
          <hr>
          <code>Horas Trabalhadas (Tipo de Manutenção)</code> refere-se às horas de trabalho dedicadas a atividades de
          manutenção de um determinado tipo.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (tipo de manutenção)</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable9" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Tipo de manutenção</td>
                  <td>Horas</td>
                </tr>
              </thead>
              <tbody id="tabelaBody9">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Horas trabalhadas (área manutenção) -->

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (área manutenção)</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico8"></canvas>
          </div>
          <hr>
          <code>Horas Trabalhadas (Área de Manutenção)</code> indica o total de horas de trabalho gastas em atividades
          de manutenção em uma área específica.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (área manutenção)</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable10" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Área de manutenção</td>
                  <td>Horas</td>
                </tr>
              </thead>
              <tbody id="tabelaBody10">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xl-8 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (por Setor)</h6>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="grafico9"></canvas>
          </div>
          <hr>
          <code>Horas Trabalhadas (por Setor)</code> representa o total de horas de trabalho dedicadas à manutenção em
          um setor específico da empresa.
        </div>
      </div>
    </div>
    <div class="col-xl-4 mb-2">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Horas trabalhadas (por Setor)</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable11" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <td>Setor</td>
                  <td>OS</td>
                </tr>
              </thead>
              <tbody id="tabelaBody11">

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endblock %}

  {% block scripts %}
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

  <!-- (Optional) Latest compiled and minified JavaScript translation files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>

  <!-- Page level plugins -->
  <script src="static/vendor/chart.js/Chart.min.js"></script>

  <!-- Page level custom scripts -->
  <script src="static/js/demo/chart-area-demo.js"></script>
  <script src="static/js/demo/chart-pie-demo.js"></script>
  <script src="static/js/demo/chart-bar-demo.js"></script>
  <!-- Page level custom scripts -->
  <script src="static/js/demo/datatables-demo.js"></script>
  <!-- Bootstrap core JavaScript-->
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="static/vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Page level plugins -->
  <script src="static/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="static/vendor/datatables/dataTables.bootstrap4.min.js"></script>

  <script src="https://kit.fontawesome.com/d1807a784c.js" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

  <script>
    function validateForm() {
      var inputDate = document.getElementById('inputDate1').value;

      // Verifica se a data está no formato correto
      if (!isValidDateRange(inputDate) && inputDate !== '') {
        alert('Formato de data inválido. Use o formato DD/MM/YYYY - DD/MM/YYYY.');
        return false; // Impede o envio do formulário
      }

      var dateRange = inputDate.split(' - '); // ['02/01/2024', '19/01/2024']
      var startDateComponents = dateRange[0].split('/');
      var endDateComponents = dateRange[1].split('/');

      // Cria as datas invertendo os componentes
      var startDate = new Date(startDateComponents[2], startDateComponents[1] - 1, startDateComponents[0]);
      var endDate = new Date(endDateComponents[2], endDateComponents[1] - 1, endDateComponents[0]);

      // Define as datas de restrição
      var minDate = new Date('2023-06-22');
      var maxDate = new Date();

      // Verifica se as datas estão dentro do intervalo permitido
      if (startDate < minDate || endDate > maxDate) {
        alert('A primeira data não pode ser anterior a 22/06/2023 e a segunda data não pode ser posterior a hoje.');
        return false; // Impede o envio do formulário
      }

      return true; // Permite o envio do formulário
    }

    function isValidDateRange(dateRange) {
      var dateRangePattern = /^\d{2}\/\d{2}\/\d{4} - \d{2}\/\d{2}\/\d{4}$/;
      return dateRangePattern.test(dateRange);
    }
  </script>

  <script>

    $(function () {
      $('.selectpicker').selectpicker();
    });

    $(function () {
      const dataAtual = new Date();
      const opcoesFormatacao = { day: 'numeric', month: '2-digit', year: 'numeric' };
      const dataFormatada = dataAtual.toLocaleDateString('pt-BR', opcoesFormatacao);

      var dataInicial = dataFormatada.split(" - ")[0];
      var dataFinal = dataFormatada.split(" - ")[1];

      $('input[name="datetimes"]').daterangepicker({
        timePicker: true,
        timePicker24Hour: true,
        autoUpdateInput: false,
        startDate: moment(dataInicial, 'DD/MM/YYYY'),
        endDate: moment(dataFinal, 'DD/MM/YYYY'),
        locale: {
          format: 'DD/MM/YYYY',
          cancelLabel: 'Clear'
        }
      });

      $('input[name="datetimes"]').on('apply.daterangepicker', function (ev, picker) {
        $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
      });

      $('input[name="datetimes"]').on('cancel.daterangepicker', function (ev, picker) {
        $(this).val('');
      });

      $('input[name="datetimes"]').on('apply.daterangepicker', function (ev, picker) {
        var startDate = picker.startDate;
        var endDate = picker.endDate;

        if (endDate.isBefore(startDate)) {
          alert("A data final não pode ser menor que a data inicial");
          picker.setEndDate(startDate);
        }
      });
    });

    document.addEventListener("DOMContentLoaded", function () {
      // Obter o elemento de input
      var inputElement = document.getElementById("inputDate1");

      // Verificar se há um valor salvo no armazenamento local
      var savedValue = localStorage.getItem("inputDate1");

      // Se houver um valor salvo, definir o valor do input
      if (savedValue !== null) {
        inputElement.value = savedValue;
      }

      // Adicionar um ouvinte de evento para salvar o valor quando o usuário digitar
      inputElement.addEventListener("input", function () {
        // Salvar o valor no armazenamento local
        localStorage.setItem("inputDate1", inputElement.value);
      });
    });
  </script>

  <!-- <script>

    // // Bar Chart Example
    // var eixo_y = {{ dados_mtbf_maquina | safe }};
    // var eixo_x = {{ labels_mtbf_maquina | safe }};
    // // Encontrar o valor máximo no array
    // let maxValor = Math.max(...eixo_y);
    // // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    // let arredondadoMaxValor = Math.ceil(maxValor / 100) * 100;
    // if (eixo_y == NaN) {
    //   eixo_y = 500
    // }
    // var ctx = document.getElementById("grafico1");
    // var myBarChart = new Chart(ctx, {
    //   type: 'bar',
    //   data: {
    //     labels: eixo_x,
    //     datasets: [{
    //       label: 'MTBF',
    //       backgroundColor: "#4e73df",
    //       hoverBackgroundColor: "#2e59d9",
    //       borderColor: "#4e73df",
    //       data: eixo_y,
    //     }],
    //   },
    //   options: {
    //     maintainAspectRatio: false,
    //     layout: {
    //       padding: {
    //         left: 10,
    //         right: 25,
    //         top: 25,
    //         bottom: 0
    //       }
    //     },
    //     scales: {
    //       xAxes: [{
    //         time: {
    //           unit: 'month'
    //         },
    //         gridLines: {
    //           display: false,
    //           drawBorder: false
    //         },
    //         ticks: {
    //           maxTicksLimit: 6
    //         },
    //         maxBarThickness: 25,
    //       }],
    //       yAxes: [{
    //         ticks: {
    //           min: 0,
    //           max: arredondadoMaxValor,
    //           maxTicksLimit: 10,
    //           padding: 10,
    //         },
    //         gridLines: {
    //           color: "rgb(234, 236, 244)",
    //           zeroLineColor: "rgb(234, 236, 244)",
    //           drawBorder: false,
    //           borderDash: [2],
    //           zeroLineBorderDash: [2]
    //         }
    //       }],
    //     },
    //     legend: {
    //       display: false
    //     },
    //     tooltips: {
    //       titleMarginBottom: 10,
    //       titleFontColor: '#6e707e',
    //       titleFontSize: 14,
    //       backgroundColor: "rgb(255,255,255)",
    //       bodyFontColor: "#858796",
    //       borderColor: '#dddfeb',
    //       borderWidth: 1,
    //       xPadding: 15,
    //       yPadding: 15,
    //       displayColors: false,
    //       caretPadding: 10,
    //     },
    //   }
    // });



    // Bar Chart Example
    var eixo_y = {{ dados_mtbf_top10_maquina | safe }};
    var eixo_x = {{ labels_mtbf_top10_maquina | safe }};
    var ctx = document.getElementById("grafico1top10");
    let maxValor2 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor2 = Math.ceil(maxValor2 / 100) * 100;
    if (eixo_y == NaN) {
      eixo_y = 500
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor2,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });
    // Gráfico MTBF por setor
    var eixo_y = {{ dados_mtbf_setor | safe }};
    var eixo_x = {{ labels_mtbf_setor | safe }};
    var ctx = document.getElementById('grafico2');
    let maxValor3 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor3 = Math.ceil(maxValor3 / 100) * 100;
    if (eixo_y == NaN) {
      eixo_y = 500
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor3,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });
    // Gráfico MTTR por máquina

    // Gráfico MTBF por setor
    var eixo_y = {{ dados_mttr_maquina | safe }};
    var eixo_x = {{ labels_mttr_maquina | safe }};
    var ctx = document.getElementById('grafico3');
    let maxValor4 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor4 = Math.ceil(maxValor4 / 50) * 50;
    if (eixo_y == NaN) {
      eixo_y = 100
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor4,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });

    // Gráfico MTTR por setor

    var eixo_y = {{ dados_mttr_setor | safe }};
    var eixo_x = {{ labels_mttr_setor | safe }};
    var ctx = document.getElementById('grafico4');
    let maxValor5 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor5 = Math.ceil(maxValor5 / 50) * 50;
    if (eixo_y == NaN) {
      eixo_y = 100
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor5,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });

    // Disponibilidade por maquina

    var eixo_y = {{ dados_disponibilidade_maquina | safe }};
    var eixo_x = {{ labels_disponibilidade_maquina | safe }};
    var ctx = document.getElementById('grafico5');
    let maxValor6 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor6 = Math.ceil(maxValor6 / 100) * 100;
    if (eixo_y == NaN) {
      eixo_y = 500
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor6,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });

    // Disponibilidade por setor

    var eixo_y = {{ dados_disponibilidade_setor | safe }};
    var eixo_x = {{ labels_disponibilidade_setor | safe }};
    var ctx = document.getElementById('grafico6');
    let maxValor7 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor7 = Math.ceil(maxValor7 / 100) * 100;
    if (eixo_y == NaN) {
      eixo_y = 500
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor7,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });

    var eixo_y = {{ dados_horas_trabalhadas_tipo | safe }};
    var eixo_x = {{ labels_horas_trabalhadas_tipo | safe }};
    var ctx = document.getElementById('grafico7');

    var myBarChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#ffd369', '#f87474'],
          hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        tooltips: {
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
        legend: {
          display: false
        },
        cutoutPercentage: 50,
      },
    });


    var eixo_y = {{ dados_horas_trabalhadas_area | safe }};
    var eixo_x = {{ labels_horas_trabalhadas_area | safe }};
    var ctx = document.getElementById('grafico8');

    var myBarChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#ffd369', '#f87474'],
          hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        tooltips: {
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
        legend: {
          display: false
        },
        cutoutPercentage: 50,
      },
    });

    var eixo_y = {{ dados_horas_trabalhadas_setor | safe }};
    var eixo_x = {{ labels_horas_trabalhadas_setor | safe }};
    var ctx = document.getElementById('grafico9');
    let maxValor8 = Math.max(...eixo_y);
    // Arredondar o valor máximo para cima para o múltiplo mais próximo de 50
    let arredondadoMaxValor8 = Math.ceil(maxValor8 / 100) * 100;
    if (eixo_y == NaN) {
      eixo_y = 500
    }
    var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: eixo_x,
        datasets: [{
          label: 'MTBF',
          backgroundColor: "#4e73df",
          hoverBackgroundColor: "#2e59d9",
          borderColor: "#4e73df",
          data: eixo_y,
        }],
      },
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            left: 10,
            right: 25,
            top: 25,
            bottom: 0
          }
        },
        scales: {
          xAxes: [{
            time: {
              unit: 'month'
            },
            gridLines: {
              display: false,
              drawBorder: false
            },
            ticks: {
              maxTicksLimit: 6
            },
            maxBarThickness: 25,
          }],
          yAxes: [{
            ticks: {
              min: 0,
              max: arredondadoMaxValor8,
              maxTicksLimit: 10,
              padding: 10,
            },
            gridLines: {
              color: "rgb(234, 236, 244)",
              zeroLineColor: "rgb(234, 236, 244)",
              drawBorder: false,
              borderDash: [2],
              zeroLineBorderDash: [2]
            }
          }],
        },
        legend: {
          display: false
        },
        tooltips: {
          titleMarginBottom: 10,
          titleFontColor: '#6e707e',
          titleFontSize: 14,
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
      }
    });

  </script> -->

  <!-- MTBF POR MÁQUINA e TOP 10 MTBF POR MÁQUINA -->
  <script>
    // Variável global para armazenar a referência ao gráfico
    let chartMtbfMaquina;
    let chartTop10MtbfMaquina;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoMtbfMaquina(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_mtbf_maquina', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas,
          // historico_checked: historicoChecked
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {
          data.resultados.sort((a, b) => a.resultado_mtbf - b.resultado_mtbf);

          data.resultados = data.resultados.filter(item => item.maquina !== null && item.maquina.trim() !== "Telhado" && item.maquina.trim() !== "ETE"
            && item.maquina.trim() !== "Ultrassom" && item.maquina.trim() !== "Termográfica");

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico1').getContext('2d');
          const maquinas = data.resultados.map(item => item.maquina);
          const resultados = data.resultados.map(item => item.resultado_mtbf);

          // Destrua o gráfico anterior se existir
          if (chartMtbfMaquina) {
            chartMtbfMaquina.destroy();
          }
          // Destrua o gráfico anterior se existir
          if (chartTop10MtbfMaquina) {
            chartTop10MtbfMaquina.destroy();
          }

          // Dados para o top 10 mtbf de máquinas
          const ctx_top_10 = document.getElementById('grafico1top10').getContext('2d');
          var top10Resultados = data.resultados.slice(0, 10);
          const maquinas_top10 = top10Resultados.map(item => item.maquina);
          const resultados_top10 = top10Resultados.map(item => item.resultado_mtbf);

          // Gráfico mtbf por máquina
          chartMtbfMaquina = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: maquinas,
              datasets: [{
                label: 'MTBF por máquina',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Gráfico top 10 mtbf por máquina
          chartTop10MtbfMaquina = new Chart(ctx_top_10, {
            type: 'bar',
            data: {
              labels: maquinas_top10,
              datasets: [{
                label: 'MTBF por máquina',
                data: resultados_top10,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabela_mtbf_maquina(data);
          preencherTabela_top_10_mtbf_maquina(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabela_mtbf_maquina(data) {
      $('#dataTable2').DataTable().destroy();

      var tabelaBody = $('#tabelaBody2');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.resultado_mtbf - b.resultado_mtbf);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.maquina + '</td>');
        newRow.append('<td>' + row.resultado_mtbf + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable2').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

    function preencherTabela_top_10_mtbf_maquina(data) {
      $('#dataTable3').DataTable().destroy();

      var tabelaBody = $('#tabelaBody3');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.resultado_mtbf - b.resultado_mtbf);
      var top10Resultados = data.resultados.slice(0, 10);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(top10Resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.maquina + '</td>');
        newRow.append('<td>' + row.resultado_mtbf + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable3').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- MTBF POR SETOR -->
  <script>
    // Variável global para armazenar a referência ao gráfico
    let chartMtbfSetor;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoMtbfSetor(selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_mtbf_setor', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {
          data.resultados.sort((a, b) => a.resultado_mtbf - b.resultado_mtbf);

          // Destrua o gráfico anterior se existir
          if (chartMtbfSetor) {
            chartMtbfSetor.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico2').getContext('2d');
          const setores = data.resultados.map(item => item.setor);
          const resultados = data.resultados.map(item => item.resultado_mtbf);

          // Crie um novo gráfico
          chartMtbfSetor = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: setores,
              datasets: [{
                label: 'MTTR por máquina',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabela_mtbf_setor(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabela_mtbf_setor(data) {
      $('#dataTable4').DataTable().destroy();

      var tabelaBody = $('#tabelaBody4');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.resultado_mtbf - b.resultado_mtbf);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.setor + '</td>');
        newRow.append('<td>' + row.resultado_mtbf + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable4').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }
  </script>

  <!-- MTTR POR MÁQUINA -->
  <script>
    let chartMttrMaquina;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoMttrMaquina(selectedOptions, maquinasFavoritas, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_mttr_maquina', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {
          data.resultados.sort((a, b) => a.resultado_mttr - b.resultado_mttr);
          
          data.resultados = data.resultados.filter(item => item.maquina !== null && item.maquina.trim() !== "Telhado" && item.maquina.trim() !== "ETE"
            && item.maquina.trim() !== "Ultrassom" && item.maquina.trim() !== "Termográfica");

          // Destrua o gráfico anterior se existir
          if (chartMttrMaquina) {
            chartMttrMaquina.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico3').getContext('2d');
          const maquinas = data.resultados.map(item => item.maquina);
          const resultados = data.resultados.map(item => item.resultado_mttr);

          // Gráfico mtbf por maquina
          chartMttrMaquina = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: maquinas,
              datasets: [{
                label: 'MTTR por máquina',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabela_mttr_maquina(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabela_mttr_maquina(data) {
      $('#dataTable5').DataTable().destroy();

      var tabelaBody = $('#tabelaBody5');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.resultado_mttr - b.resultado_mttr);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.maquina + '</td>');
        newRow.append('<td>' + row.resultado_mttr + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable5').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- MTTR POR SETOR -->
  <script>
    let chartMttrSetor;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoMttrSetor(selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_mttr_setor', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {

          data.resultados.sort((a, b) => a.resultado_mttr - b.resultado_mttr);

          // Destrua o gráfico anterior se existir
          if (chartMttrSetor) {
            chartMttrSetor.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico4').getContext('2d');
          const setores = data.resultados.map(item => item.setor);
          const resultados = data.resultados.map(item => item.resultado_mttr);

          // Gráfico mtbf por maquina
          chartMttrSetor = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: setores,
              datasets: [{
                label: 'MTTR por setor',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabela_mttr_setor(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabela_mttr_setor(data) {
      $('#dataTable6').DataTable().destroy();

      var tabelaBody = $('#tabelaBody6');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.resultado_mttr - b.resultado_mttr);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.setor + '</td>');
        newRow.append('<td>' + row.resultado_mttr + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable6').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- DISPONIBILIDADE POR MÁQUINA -->
  <script>
    let chartDisponibilidadeMaquina;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoDisponibilidadeMaquina(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/disponibilidade_maquina', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {

          const mediaDisponibilidade = data.resultados.reduce((total, resultado) => total + resultado.disponibilidade, 0) / data.resultados.length;

          document.getElementById('cardDisponibilidade').textContent = mediaDisponibilidade.toFixed(2) * 100 + '%';

          data.resultados.sort((a, b) => a.disponibilidade - b.disponibilidade);
          data.resultados = data.resultados.filter(item => item.codigo_tratado !== null && item.codigo_tratado.trim() !== "Telhado" && item.codigo_tratado.trim() !== "ETE"
            && item.codigo_tratado.trim() !== "Ultrassom" && item.codigo_tratado.trim() !== "Termográfica");

          // Destrua o gráfico anterior se existir
          if (chartDisponibilidadeMaquina) {
            chartDisponibilidadeMaquina.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico5').getContext('2d');
          const maquinas = data.resultados.map(item => item.codigo_tratado);
          const resultados = data.resultados.map(item => item.disponibilidade);

          // Gráfico mtbf por maquina
          chartDisponibilidadeMaquina = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: maquinas,
              datasets: [{
                label: 'Disponibilidade por máquina',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabelaDisponibilidadeMaquina(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabelaDisponibilidadeMaquina(data) {
      $('#dataTable7').DataTable().destroy();

      var tabelaBody = $('#tabelaBody7');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.disponibilidade - b.disponibilidade);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.codigo_tratado + '</td>');
        newRow.append('<td>' + row.disponibilidade.toFixed(2) * 100 + "%" + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable7').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- DISPONIBILIDADE POR SETOR -->
  <script>
    let chartDisponibilidadeSetor;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoDisponibilidadeSetor(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/disponibilidade_setor', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {
          data.resultados.sort((a, b) => a.disponibilidade - b.disponibilidade);

          // Destrua o gráfico anterior se existir
          if (chartDisponibilidadeSetor) {
            chartDisponibilidadeSetor.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico6').getContext('2d');
          const setores = data.resultados.map(item => item.setor);
          const resultados = data.resultados.map(item => item.disponibilidade);

          // Gráfico mtbf por maquina
          chartDisponibilidadeSetor = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: setores,
              datasets: [{
                label: 'Disponibilidade por setor',
                data: resultados,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabelaDisponibilidadeSetor(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabelaDisponibilidadeSetor(data) {
      $('#dataTable8').DataTable().destroy();

      var tabelaBody = $('#tabelaBody8');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.disponibilidade - b.disponibilidade);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.setor + '</td>');
        newRow.append('<td>' + row.disponibilidade.toFixed(2) * 100 + "%" + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable8').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- HORAS TRABALHADOS POR TIPO DE MANUTENÇÃO -->
  <script>

    let chartHorasTipo;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoTipoManutencao(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_horas_trabalhadas_tipo_manutencao', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {

          // Destrua o gráfico anterior se existir
          if (chartHorasTipo) {
            chartHorasTipo.destroy();
          }

          const ctx = document.getElementById('grafico7').getContext('2d');
          const tipo_ = data.resultados.map(item => item.tipo);
          const horas_ = data.resultados.map(item => item.horas);

          chartHorasTipo = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: tipo_,
              datasets: [{
                label: 'Horas por tipo de manutenção',
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#ffd369', '#f87474'],
                hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
                data: horas_,
              }],
            },
            options: {
              maintainAspectRatio: false,
              tooltips: {
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
              legend: {
                display: true
              },
              cutoutPercentage: 50,
            },
          });

          // Preencha a tabela
          preencherTabelaTipoManutencao(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabelaTipoManutencao(data) {
      $('#dataTable9').DataTable().destroy();

      var tabelaBody = $('#tabelaBody9');

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.tipo + '</td>');
        newRow.append('<td>' + row.horas + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable9').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- HORAS TRABALHADOS POR ÁREA DE MANUTENÇÃO -->
  <script>
    let chartHorasArea;

    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoAreaManutencao(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_horas_trabalhadas_area_manutencao', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {

          // Destrua o gráfico anterior se existir
          if (chartHorasArea) {
            chartHorasArea.destroy();
          }

          const ctx = document.getElementById('grafico8').getContext('2d');
          const area_ = data.resultados.map(item => item.area);
          const horas_ = data.resultados.map(item => item.horas);

          chartHorasArea = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: area_,
              datasets: [{
                label: 'Horas por area de manutenção',
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#ffd369', '#f87474'],
                hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
                data: horas_,
              }],
            },
            options: {
              maintainAspectRatio: false,
              tooltips: {
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
              legend: {
                display: true
              },
              cutoutPercentage: 50,
            },
          });

          // Preencha a tabela
          preencherTabelaAreaManutencao(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabelaAreaManutencao(data) {
      $('#dataTable10').DataTable().destroy();

      var tabelaBody = $('#tabelaBody10');

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.area + '</td>');
        newRow.append('<td>' + row.horas + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable10').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- HORAS TRABALHADAS POR SETOR -->
  <script>

    let chartHorasSetor;
    // Função para carregar os dados e criar o gráfico e a tabela
    function graficoHorasSetor(maquinasFavoritas, selectedOptions, dataFiltro) {
      // Substitua pela lógica que faz a solicitação à sua API
      fetch('/api/calculo_horas_setor', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {
          data.resultados.sort((a, b) => a.horas - b.horas);

          // Destrua o gráfico anterior se existir
          if (chartHorasSetor) {
            chartHorasSetor.destroy();
          }

          // Dados para o mtbf de máquinas
          const ctx = document.getElementById('grafico9').getContext('2d');
          const setores = data.resultados.map(item => item.setor);
          const horas_ = data.resultados.map(item => item.horas);

          // Gráfico mtbf por maquina
          chartHorasSetor = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: setores,
              datasets: [{
                label: 'Horas trabalhadas por setor',
                data: horas_,
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                borderWidth: 1
              }]
            },
            options: {
              maintainAspectRatio: false,
              layout: {
                padding: {
                  left: 10,
                  right: 25,
                  top: 25,
                  bottom: 0
                }
              },
              scales: {
                x: {
                  gridLines: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    maxTicksLimit: 6
                  },
                  maxBarThickness: 25,
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    min: 0,
                    // max: arredondadoMaxValor2,
                    maxTicksLimit: 10,
                    padding: 10,
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2]
                  }
                }
              },
              legend: {
                display: false
              },
              tooltips: {
                titleMarginBottom: 10,
                titleFontColor: '#6e707e',
                titleFontSize: 14,
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
              },
            }
          });

          // Preencha a tabela
          preencherTabelaHorasSetor(data);
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

    // Função para preencher a tabela com os dados
    function preencherTabelaHorasSetor(data) {
      $('#dataTable11').DataTable().destroy();

      var tabelaBody = $('#tabelaBody11');

      // Ordena os dados pelo resultado
      data.resultados.sort((a, b) => a.horas - b.horas);

      // Limpa o conteúdo atual da tabela
      tabelaBody.empty();

      // Itera sobre os dados e cria as linhas da tabela
      $.each(data.resultados, function (index, row) {
        var newRow = $('<tr>');
        newRow.append('<td>' + row.setor + '</td>');
        newRow.append('<td>' + row.horas + '</td>');
        tabelaBody.append(newRow);
      });

      // Inicialize o DataTable após preencher a tabela
      $('#dataTable11').DataTable({
        order: [[1, 'asc']],
        "info": false,
        "aLengthMenu": [4, 10],
        "iDisplayLength": 4
      });
    }

  </script>

  <!-- CARDS -->
  <script>

    // Função para fazer a solicitação à API e preencher o valor no card
    function valoresCards(maquinasFavoritas, selectedOptions, dataFiltro) {
      fetch('/api/calculo_cards', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          // dia_inicial: dataInicio,
          // dia_final: dataFim,
          data_filtro: dataFiltro,
          setores_selecionados: selectedOptions,
          maquinasFavoritas: maquinasFavoritas
          // Adicione outros parâmetros conforme necessário
        })
      })
        .then(response => response.json())
        .then(data => {

          // Encontre o item com o status 'Em execução'
          const itemFinalizada = data.resultados.find(item => item.status === 'Finalizada');
          // Obtenha a quantidade, se o item existir
          const quantidadeFinalizada = itemFinalizada ? itemFinalizada.quantidade : 0;

          document.getElementById('statusFinalizada').textContent = quantidadeFinalizada;

          // Encontre o item com o status 'Aguardando material'
          const itemAguardando = data.resultados.find(item => item.status === 'Aguardando material');
          // Obtenha a quantidade, se o item existir
          const quantidadeAguardando = itemAguardando ? itemAguardando.quantidade : 0;

          document.getElementById('statusAguardando').textContent = quantidadeAguardando;

          // Encontre o item com o status 'Em execução'
          const itemEspera = data.resultados.find(item => item.status === 'Em espera');
          // Obtenha a quantidade, se o item existir
          const quantidadeEspera = itemEspera ? itemEspera.quantidade : 0;

          document.getElementById('statusEspera').textContent = quantidadeEspera;

          // Encontre o item com o status 'Em execução'
          const itemExecucao = data.resultados.find(item => item.status === 'Em execução');
          // Obtenha a quantidade, se o item existir
          const quantidadeExecucao = itemExecucao ? itemExecucao.quantidade : 0;

          document.getElementById('statusExecucao').textContent = quantidadeExecucao;

        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    }

  </script>

  <!-- CHAMANDO OS GRÁFICOS -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('buttonFilter').addEventListener('click', function () {
        // Obtenha os valores selecionados nos campos do formulário
        // const historicoChecked = document.getElementById('historico').checked;

        const selectedSetores = Array.from(document.getElementsByName('filtro_setor'))
          .filter(option => option.selected)
          .map(option => option.value);

        const dataFiltro = document.getElementById('inputDate1').value;
        const maquinasFavoritas = document.getElementById('maquinas-favoritas').checked;
        const selectSetor = document.getElementById('selectSetor');
        const selectedOptions = Array.from(selectSetor.selectedOptions).map(option => option.value);

        console.log(dataFiltro);

        // Converte a string da data para o formato desejado
        // const [dataInicioStr, dataFimStr] = dataFiltro.split(' - ');
        // const dataInicio = formatDate(dataInicioStr);
        // const dataFim = formatDate(dataFimStr);

        valoresCards(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoHorasSetor(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoAreaManutencao(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoTipoManutencao(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoMttrSetor(selectedOptions, dataFiltro);
        graficoMttrMaquina(selectedOptions, maquinasFavoritas, dataFiltro);
        graficoMtbfSetor(selectedOptions, dataFiltro);
        graficoMtbfMaquina(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoDisponibilidadeMaquina(maquinasFavoritas, selectedOptions, dataFiltro);
        graficoDisponibilidadeSetor(maquinasFavoritas, selectedOptions, dataFiltro);

      });
    });
  </script>

  <script>
    // Função para formatar a data
    function formatDate(dateStr) {
      const [day, month, year] = dateStr.split('/');
      return `${year}-${month}-${day}`;
    }
  </script>

  {% endblock %}