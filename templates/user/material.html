{% extends "user/layout.html" %}
{% block body %}

<style>
  th, td {
    text-align: center;
  }
</style>

<div id = 'form_inserir_material' class="card card-body">
  <form action="{{ url_for('routes.get_material', id_ordem=id_ordem) }}" method="POST">
      <table>
          <thead>
              <tr>
                  <td>Codigo</td>
                  <td>Quantidade</td>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td><input type="text" class="form-control" name="codigo" required></td>
                  <td><input type="text" class="form-control" name="quantidade" required></td>
              </tr>
          </tbody>
      </table>
      <br>
      <button class="btn btn-primary btn-block">
          Inserir 
      </button>
  </form>
</div>
<br>
<div id = 'table_materiais_utilizados' class="col-md-8">
<div id = 'titulo_materiais_utilizados' class="row"><h3>Materiais utilizados</h3></div>
<table id="example" class="table table-striped table-bordered" style="width:100%">
  <thead>
    <tr>
      <td>Codigo</td>
      <td>Quantidade</td>
      <td>Valor</td>
    </tr>
  </thead>
  <tbody>
  {% for data in datas %}
  <tr>
      <td>{{data.codigo}} - {{data.descricao}}</td>
      <td>{{data.quantidade}}</td>
      <td class="coluna-valores">R$ {{data.total}}</td>
  </tr>
  {% endfor %}
  </tbody>
  <tfoot>
      <tr>
          <th>Valor total</th>
          <th></th>
          <th id="valor-total">R$ {{valorTotal}}</th>
      </tr>
  </tfoot>
</table>
</div>

<script>
  // Obtenha o elemento que contém o valor total
  var thValorTotal = document.getElementById('valor-total');

  var thValorText = thValorTotal.textContent;

  var valorTotalNumerico = thValorText.replace(/[^\d.-]/g, '');

  var valorFloat = parseFloat(valorTotalNumerico);

  if (!isNaN(valorFloat)) {
    // Formata o valor como moeda
    var formatoMoeda = valorFloat.toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });

    // Atualiza o valor no elemento "valor-total" com a moeda formatada
    thValorTotal.textContent = formatoMoeda;
  }
</script>

<script>
  // Obtém todas as células da coluna que contém os valores float (índice da coluna, começando em 0)
  var colunaValores = document.querySelectorAll('#example td.coluna-valores');

  // Percorre todas as células da coluna
  for (var i = 0; i < colunaValores.length; i++) {
  var valorCelula = colunaValores[i].textContent;

  // Remove caracteres não numéricos (exceto ponto decimal) da string
  var valorNumerico = valorCelula.replace(/[^\d.-]/g, '');

  // Converte o valor para float
  var valorFloat = parseFloat(valorNumerico);

  // Verifica se o valor é um número válido
  if (!isNaN(valorFloat)) {
      // Formata o valor como moeda
      var formatoMoeda = valorFloat.toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
      });

      // Atualiza o valor da célula com a moeda formatada
      colunaValores[i].textContent = formatoMoeda;
  }
  }
</script>
  
{% endblock %}