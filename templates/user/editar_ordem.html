{% extends "user/layout.html" %}
{% block body %}

{% with messages = get_flashed_messages()  %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-success" role="sucess" style="width: 45%;">
    <strong>Sucesso!</strong> {{ message }}
    <button type="button" class="close" data-dismiss="sucess" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

    <div id ="formulario_preventiva" class="card card-body" style="transform: translate(-50%,7%);">
      
      <div id = 'abertura_titulo' class="row justify-content-center align-items-center mb-3">
          <a href="#" onclick="window.history.back();" class="botao-voltar">
            <i class="fas fa-arrow-left"></i>
          </a>
        <h5 style="font-size: 20px; margin-left: 120px; margin-right: 50px;">Editar Ordem</h5>
        <button id="menu-button"><i class="fa-solid fa-bars"></i></button>
      </div> 
        <form action="/update_ordem/{{ordem[10]}}/{{ordem[11]}}" method="POST">
            <div class="form-group">
                <label for="setor">Setor:</label>
                <input type="text" name="setor" value="{{ordem[1]}}" class="form-control" disabled>
            </div>
            <div class="form-group">
                <label for="maquina">Máquina ou Local:</label>
                <input type="text" name="maquina" value="{{ordem[2]}}" class="form-control" disabled>
            </div>
            <div class="form-group">
                <label for="problema">Descrição do usuário:</label>
                <textarea id="problema" class="form-control" name="problema" rows="5" cols="41" required disabled>{{ordem[5]}}</textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="risco">Risco</label>    
                    <input type="text" name="risco" value="{{ordem[3]}}" class="form-control" disabled> 
                </div>
                <div class="form-group">
                    <label for="n_ordem">Número da execução:</label>
                    <input type="text" name="n_ordem" value="{{ordem[11]}}" class="form-control" disabled>
                </div>
            </div>
            <div class="form-row">
            <div class="form-group"> 
                <label for="tipo_manutencao">Tipo de manutenção</label>
                <select style = 'height: 50px;' class="form-control form-control" name="tipo_manutencao1" id="tipo_manutencao1">
                    <option value="{{ tipo_manutencao }}">{{ tipo_manutencao }}</option>  
                    <option value="Corretiva">Corretiva</option>
                    <option value="Preventiva">Preventiva</option>
                    <option value="Preditiva">Preditiva</option>
                    <option value="Apoio">Apoio</option>
                    <option value="Projetos">Projetos</option>
                    <option value="sesmt">SESMT</option>  
                    <option value="Corretiva Programada">Corretiva Programada</option>  
                </select>               
            </div>

            <div class="form-group"> 
                <label for="area_manutencao">Área de manutenção</label>
                <select style = 'height: 50px;' class="form-control form-control" name="area_manutencao1" id="area_manutencao1">
                    <option value="{{ area_manutencao }}">{{ area_manutencao }}</option>  
                    <option value="Predial">Predial</option>
                    <option value="Mecânica">Mecânica</option>
                    <option value="Elétrica">Elétrica</option>
                </select>               
            </div>
            </div>
            <div class="form-group">
                <label for="statusLista">Data e hora</label>
                <input id="data_edit" type="text" name="datetimes" value="{{data_atual}}" />
            </div>
            <div class="form-group"> 
                <label for="operador_label">Operadores</label>
                <select class="form-control" id="operador" name="operador" multiple required>
                    {% for funcionario in tb_funcionarios %}
                        {% if funcionario[0] in executante %}
                            <option selected>{{ funcionario[0] }}</option>
                        {% else %}
                            <option>{{ funcionario[0] }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="descmanutencao">Observação da manutenção:</label>
                <textarea id="descmanutencao" class="form-control" name="descmanutencao" rows="5" cols="41">{{ desc_manutencao }}</textarea>
            </div>
            <div class="form-group">        
                <label for="statusLista">Status</label>
                <select class="form-control form-control" id="statusLista" name="statusLista">
                    {% for opcao in opcoes %}
                    <option value="{{ opcao }}">{{ opcao }}</option>
                    {% endfor %}
                </select>
            </div>
            <br>
            <div class="form-group">
            <button id = 'salvar_edicao' type="submit" class="btn btn-primary btn-block">
                Salvar
            </button>
            </div>
        </form>
    </div>
</div>
</div>

<script>
    $(function() {
      var dataAtual = "{{ data_atual }}";
      var dataInicial = dataAtual.split(" - ")[0];
      var dataFinal = dataAtual.split(" - ")[1];
    
      $('input[name="datetimes"]').daterangepicker({
        timePicker: true,
        timePicker24Hour: true,
        startDate: moment(dataInicial, 'DD/MM/YYYY HH:mm'),
        endDate: moment(dataFinal, 'DD/MM/YYYY HH:mm'),
        locale: {
          format: 'DD/MM/YYYY HH:mm'
        }
      });
    
      $('input[name="datetimes"]').on('apply.daterangepicker', function(ev, picker) {
        var startDate = picker.startDate;
        var endDate = picker.endDate;
    
        if (endDate.isBefore(startDate)) {
          alert("A data final não pode ser menor que a data inicial");
          picker.setEndDate(startDate);
        }
      });
    });
</script>

{% endblock %}